<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Serena Bonaretti" />
  <meta name="author" content="Egon Willighagen" />
  <meta name="dcterms.date" content="2019-08-02" />
  <meta name="keywords" content="FAIR, …" />
  <title>Two use cases of FAIR maturity indicators in the life sciences</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Two use cases of FAIR maturity indicators in the life sciences</h1>
</header>
<p><small><em> This manuscript was automatically generated on August 2, 2019. </em></small></p>
<h2 id="authors">Authors</h2>
<ul>
<li><p><strong>Serena Bonaretti</strong><br> <img src="images/orcid.svg" alt="ORCID icon" class="inline_icon" /> <a href="https://orcid.org/0000-0003-4264-1773">0000-0003-4264-1773</a> · <img src="images/github.svg" alt="GitHub icon" class="inline_icon" /> <a href="https://github.com/sbonaretti">sbonaretti</a> · <img src="images/twitter.svg" alt="Twitter icon" class="inline_icon" /> <a href="https://twitter.com/SerenaBonaretti">SerenaBonaretti</a><br> <small> Department of Bioinformatics, Maastricht University, The Netherlands </small></p></li>
<li><p><strong>Egon Willighagen</strong><br> <img src="images/orcid.svg" alt="ORCID icon" class="inline_icon" /> <a href="https://orcid.org/0000-0001-7542-0286">0000-0001-7542-0286</a> · <img src="images/github.svg" alt="GitHub icon" class="inline_icon" /> <a href="https://github.com/egonw">egonw</a> · <img src="images/twitter.svg" alt="Twitter icon" class="inline_icon" /> <a href="https://twitter.com/egonwillighagen">egonwillighagen</a><br> <small> Department of Bioinformatics, Maastricht University, The Netherlands </small></p></li>
</ul>
<h2 id="abstract" class="page_break_before">Abstract</h2>
<p>Data reuse is crucial to enhance scientific progress and maximize return on science investments. Given the incremented availability, manual and automatic retrieval of data for new research questions can be challenging. Among the guidelines created to enhance data retrieval, the FAIR (findable, accessible, interoperable, reusable) principles are increasingly adopted at an institutional and funding level. Metrics to assess FAIRness of data repositories are under study and contributions are highly encouraged. In this work, we propose four real use-cases of researchers retrieving data from four different repositories (eNanoMapper, ChEBI, Gene Expression Omnibus, and Array Express) to answer their research questions. For each use case, we harvested data and metadata via application program interface (API) and we calculated FAIR metrics assigning “automatic pass” , “manual pass” and “ not passed” scores. We found […]. To conclude […]</p>
<h2 id="introduction" class="page_break_before">Introduction</h2>
<!--DATA SHARING AND REUSE-->
<p>Data sharing and data reuse are two complementary aspects of modern research activity [cit]. Researchers share their data for a sense of community, to demonstrate integrity of acquired data, <!--integrity--> and to enhance quality and reproducibility of research work [cit]. <!--and to benchmark findings and methodologies [cit].--> In addition, data sharing is supported by the emerging citation system for datasets <span class="citation" data-cites="xf44BZw9">[<a href="#ref-xf44BZw9" role="doc-biblioref">1</a>]</span>, scientific journals requirements [3], and funding agencies that want to maximize their return on science investments [5]. At the same time, researchers are eager to reuse available data to integrate information that answer interdisciplinary research questions [4] and to optimize use of fundings [cit]. Although attitudes towards data sharing and reuse are increasingly favorable [12], data discovery and re-use remain difficult in practice [11]. Studies show that 40% of qualitative data sets were never downloaded, and about 25% of data is used just 1-10 times. In addition, data availability decreases 17% per year [10] due to… To happen, data sharing and reuse need appropriate data management, including quality, standardization, ethics, and security [cit]. Data retrieval, the process of identifying and extracting data from a database using a query <span class="citation" data-cites="D6wjcBsJ">[<a href="#ref-D6wjcBsJ" role="doc-biblioref">2</a>]</span>, is one of the main challenges of data reuse.</p>
<p>In 2016, the FORCE 11 group proposed guidelines for data reuse in the life sciences and named them FAIR, an acronym for findable, accessible, interoperable, and reusable <span class="citation" data-cites="6DjakjNS">[<a href="#ref-6DjakjNS" role="doc-biblioref">3</a>]</span> (principles fully listed in Table <a href="#maturity_indicators">2</a>). In a short time these guidelines have gained remarkable popularity, and they are currently supported by funding agencies and political entities, such as the European Commission, the National Institutes of Health in the United States, and institutions in Africa and Australia <span class="citation" data-cites="u8Cy0psL">[<a href="#ref-u8Cy0psL" role="doc-biblioref">4</a>]</span>. In addition, many initiatives raised to promote and implement data FAIRness, such as <a href="https://www.go-fair.org/">GOFAIR</a> and <a href="https://fairsharing.org/">FAIRsharing</a>. The FAIR principles were specifically conceived as aspirational, and thus they do not specify any technical requirements for implementation, do not represent a standard, and do not imply openness of data <span class="citation" data-cites="u8Cy0psL">[<a href="#ref-u8Cy0psL" role="doc-biblioref">4</a>]</span>. The broad formulation of the FAIR principles created a large spectrum of interpretations and concerns, and raised the need to define data FAIRness evaluators. Some of the authors of the seminal paper proposed a set of FAIR metrics <span class="citation" data-cites="14foUQTpW">[<a href="#ref-14foUQTpW" role="doc-biblioref">5</a>]</span>, subsequently reformulated as FAIR maturity indicators <span class="citation" data-cites="1GHtrFYzp">[<a href="#ref-1GHtrFYzp" role="doc-biblioref">6</a>]</span>. At the same time, they invited consortia and communities to suggest and create alternative evaluators. The majority of the proposed tools are manually fillable questionnaires that provide a final score for data FAIRness (Table <a href="#literature">1</a>). However, the guidelines stress on the importance of creating “objective, quantitative, machine-interpretable” metrics <span class="citation" data-cites="14foUQTpW">[<a href="#ref-14foUQTpW" role="doc-biblioref">5</a>]</span>.</p>
<p>Two platforms are currently available: FAIR evaluation services <span class="citation" data-cites="1GHtrFYzp">[<a href="#ref-1GHtrFYzp" role="doc-biblioref">6</a>]</span> and FAIRshake <span class="citation" data-cites="aNdiyMUf">[<a href="#ref-aNdiyMUf" role="doc-biblioref">7</a>]</span>. The first … while the second… In addition, there are two studies assessing FAIRness in the databases and repositories. Dunning et al. <span class="citation" data-cites="171FPA92w">[<a href="#ref-171FPA92w" role="doc-biblioref">8</a>]</span> investigated 37 repositories using a qualitative approach including a traffic-light rating system of FAIRness using a Weber et al. <span class="citation" data-cites="fX0kfRFY">[<a href="#ref-fX0kfRFY" role="doc-biblioref">9</a>]</span> automatically analyzed retrieval of more than a million images from five research data repositories and created absolute and relative metrics.</p>
<p>In this paper, we propose a FAIRness evaluator … applied to databases used by toxicology and nanomaterial researchers. We created reproducible pipelines using python in Jupyter notebook</p>
<!--
Both data sharing and reuse require technical support to be in practice.
Researchers who want to share need public or institutional infrastructure where to store their data,
 as it has been shown that personal link broke. Shared data are commonly stored in private or public repositories.
Private repositories are not recommended as links to private repositories are often broken[7] and .
Public repositories are preferable as they provide unique data identifiers (DOI) that assure persistence of store data and provide valid support to researchers.

At the same time, researchers that want to reuse data must be able to find data.
-->
<!--
Data are the one of the basis of scientific investigations. Because of rapid technical advancement, researchers increasingly produce larger amounts of data at high speed.

It took 12 years to sequence the first human genome, while now scientists can sequence 200 human genome in one week due to the Next Generation Sequencing (NGS) [@h6RqHowr].
Similarly, ...
<!--(*double-check: this reference is from 2011, there might be more recent*).-->
<!--
This massive data production not only causes new technical challenges for data storage and management, but also is accompanied by a cultural change in the research community.
Traditionally, data usage follows a linear pattern: data are collected and analyzed, reported in publications, and stored in proprietary hardware [Griffit: @k7z1jo7g],
and shared only with close collaborators [cit].
Nowadays, researchers are more and more willing to share their data and reuse data created in other laboratories.
In this work context, data management becomes fundamental.  Data need to be standardized, stored with safety and ethical care, high quality, and provide tools for citation.  
<!-- and to create knowledge [1] through hypothesis testing [9],  and they are the source of all deep learning and machine learning, in silico testing avoiding animal testing.-->
<!--%\shared data need to be open, properly documented and trustable, of high quality, with ethical approval, and a proper citation policy -->
<!--
Data sharing and data reuse are not trivial tasks.


[1] Curty 2017. Attitudes and norms affecting scientists’ data reuse
[2] Nature
[3]
[4] 21 in Curty
[5] 18-20 in Curty
[6] Paper of science cafe [@k7z1jo7g]
[7] Gil? /  \cite{King2007}
[8] Mardis E.R. A decade’s perspective on DNA sequencing technology %(https://www.nature.com/articles/nature09796)
[9] https://phys.org/news/2018-10-big-science.html
[10] Vines
[11] Poole, 2015 from wiggings
[12] Curty et al. 2017
[13]Bishop  and  Kuula-Luumi  (2017)  (ref in )
%Nanoscience is part of life sciences (paper by Karcher)


One of the main point is that researchers need to be able to find the data that they need. Retrieving data is fundamental to reuse data. On of the guidelines we have is the FAIR metrics



Nice intro in Gregory:
Open research data are touted as having the potential to
transform science and fast-track the development of new knowledge (Gray, 2009).


Problems:
From Gary King \cite{King2007:

- URL are given, but they dont last for long.   
- Data created a few years ago

---
Data reuse is fundamental to researchers to maximize the amount of information that can be extracted from data while minimizing data creation costs.
In addition, data are important to  
-->
<!--%Databases are build with various architectures. Researchers usually access databases using the user interface. However, it is becoming more and more frequent to access databases with programmating access, which uses APIs. -->
<!--DATA SHARING AND REUSE IN OTHER DISCIPLINES-->
<!--Data sharing and reuse have been established common practices in some research fields for some years. See report + King

Sharing and reusing data requires infrastructure and guidelines.
Currently data are stored in databases with different architecture. This makes it hard for researchers to access the data in an organized and fruitful way.
Data sharing and reuse is not a novelty, as many disciplines (e.g. climatologists, ubatomic physics, see imming interview from page 25 but also others) have been doing it for a while.
FAIR principles explicit some of the data menagement principles used in communities that manage large amount of open data (e.g. Imming, page 14, page 19) + King
-->
<!---
Although in other disciplines data retrieval is well established, in the life sciences there is a lack of general guidelines.
Life sciences are very complex as they include various disciplines, such as toxicology, etc.



Although information retrieval (IR) has been extensively studied for over 60 years (Sanderson and Croft, 2012), data retrieval is a nascent field
The Open Archives Protocol for Metadata Harvesting (OAI-PMH) [Lagoze et al. 2002] has been widely adopted as an approach to allow harvesting of metadata [Sompel].
In the life sciences (but not exclusively), the FAIR (findable, accessible, interoperable, and reusable) guidelines have gained remarkable popularity.

Critics about the practical implementation of the FAIR principle: Dunning (p.187)
The FAIR principles are one of the element for data management. focus on data harvest as they do not provide guidelines for other aspects of data management, such as openness, quality, standardization, ethics, and security [Mons].
The authors define these principles as aspirational [cit] and general so that they can be adaptable to specific requirements of different communities.
-->
<!--harvestable in an interoperable manner (interoperability is about harvesting, not about data format, but about metadata formats)
Dunning: The FAIR guidelines are a fairly recent invention, published in 2014. Many of the data repositories have histories longer than that, and draw on discipline-based practices that have well established protocols for how data should be shared.s -->
<!--
History of FAIR:

-fairsharing.org website [Sansone2019]
-http://fairmetrics.org/: fair metrics working group. Metrics will be progressively implemented in the FAIRsharing registry [Sansone2019]

the ‘computability’ of standards is core to the development of FAIR metrics to measure the level of compliance of a given dataset against the relevant metadata [Sansone2019]

- vd. https://www.force11.org/datacitationprinciples

Three are the papers to reference for sure:    

- FAIR data
- FAIR metrics  
- nanopublications

Both machines and humans should be able to find the data
-->
<!--FAIR METRICS - LITERATURE-->
<!--
Paragraph about Metrics
The main point here is about metrics.
For this reason there are attempts to measure the possiblity of reusing the data.
One way is to use linked data, and this is measured using the 5 star system and yummydata + King + Others tend to have already established internal and international guidelines (e.g. s)
The promoters of the FAIR principle have recently written a guideline for metrics. They are in this paper, a website and this github repository. They do not provide any concrete example on how to implement them. We tried to implement them in the context of nanomaterial. Safety of nanomaterials is of particular interest because they can be very dangerous. The European community strongly supports data integration to merge information, and the European community tells these people to apply the FAIR principle for their databases. Therefore we tested some databases to see if they are compliant to the FAIR metrics.
Bla bla on metrics with citation to their paper. Other works: Dunning et al analyzed 37 repositories (non solo repositories, but a bit of everything - see excel, CO-Frequencies and Proportions). Without explicitely mention the metrics (metrics paper out afterwards?), they tested the FAIR principle on repositories. We are going to do the same for nanosafety online databases
Current tools to assess FAIRness of data are developped by the European xxx () and by the NIH group (https://www.fairshake.cloud/), which allow
Tables


Definition - What does Database Repository mean?
A database repository is a logical, but also sometimes physical grouping of data from related but separate databases.

This is usually done when there is a 'higher purpose' for the data, but the data items needed to do this reside on different databases. In these cases a repository is necessary to bring together the discrete data items and operate on them as one.
-->
<!--OUR CONTRIBUTION-->
<!--
We analyze two data repositories (GE and Array Express) and two databases (ChEBI)
Array Express are repositories containing data in form of files that researchers download to compute their analysis and answer their questions.
eNanoMapper and ChEBI are repositories where data are not downloadable in the form of files and the extracted information are the data themselves.


where for database we

a database stores data. A repository is a special class of database which is designed to store meta-data, that is, data that describes other data.

-->
<!--
Outline of the introduction:

- Importance of data-driven approaches in the life science  
- The number of produced data is increasing at extremely high rate  
- Differently from the past, researchers are more and more willing to share their data  
- At the same time, researchers are interested in reusing data  
- Data sharing and reuse are two sides of the same coin. It is important that researchers that share data provide sufficient information for data to be findable, accessible, interoperable, and reusable (FAIR)  
- A few words about FAIR  
- There is need to quantify FAIRness: literature comparison about existing approaches  
- In this paper, we present one possible approach to calculate FAIR maturity indicators.  

-->
<!-- Table1: FAIR principle evaluators-->
<a name="literature"></a>
<table style="width:100%;">
<caption>
<span>Table 1:</span> Available tools and studies to assess FAIRness. FAIRness evaluators and studies assessing FAIRness of databases and repositories in the literature. Details of the studies are in Table (Table 2).
</caption>
<colgroup>
<col style="width: 13%" />
<!-- authors -->
<col style="width: 15%" />
<!-- tool -->
<col style="width: 10%" />
<!-- manual -->
<col style="width: 11%" />
<!-- automatic - code / language -->
<col style="width: 11%" />
<!-- automatic - metadata format -->
<col style="width: 11%" />
<!-- automatic - protocol  -->
<col style="width: 10%" />
<!-- repository -->
</colgroup>
<thead>
<tr class="header">
<th colspan="1">
Authors
</th>
<th colspan="1">
Questionnaire / Platform
</th>
<th colspan="1">
Manual Assessment
</th>
<th colspan="3">
Automatic Assessment
</th>
<th colspan="1">
Data / Code Repository
</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>
</td>
<td>
</td>
<td>
</td>
<td>
Code / Language
</td>
<td>
Metadata Format
</td>
<td>
Protocol / Library
</td>
<td>
</td>
</tr>
<thead>
<tr class="header">
<th colspan="7">
FAIRness evaluators
</th>
</tr>
</thead>
<!-- Wilkinsons - metrics -->
<tr class="even">
<td>
Wilkinsons et al. <span class="citation" data-cites="14foUQTpW">[<a href="#ref-14foUQTpW" role="doc-biblioref">5</a>]</span>
</td>
<td>
-
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
<a href="https://github.com/FAIRMetrics/Metrics/tree/master/MaturityIndicators/Gen1">GitHub</a>
</td>
</tr>
<!-- Australian Research Data Commons -->
<tr class="odd">
<td>
Australian Research Data Commons
</td>
<td>
<a href="https://www.ands-nectar-rds.org.au/fair-tool">FAIR self-assessment tool</a>
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
</tr>
<!-- Commonwealth Scientific and Industrial Research Organization -->
<tr class="even">
<td>
Commonwealth Scientific and Industrial Research Organization
</td>
<td>
<a href="http://oznome.csiro.au/5star/">5 star data rating tool</a>
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
</tr>
<!-- Data Archiving and Networked Services -->
<tr class="even">
<td>
Data Archiving and Networked Services
</td>
<td>
<a href="https://docs.google.com/forms/d/e/1FAIpQLSf7t1Z9IOBoj5GgWqik8KnhtH3B819Ch6lD5KuAz7yn0I0Opw/viewform">FAIR enough?</a> and <a href="https://www.surveymonkey.com/r/fairdat">FAIR data assessment tool</a>
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
</tr>
<!-- GOFAIR consortium -->
<tr class="odd">
<td>
GOFAIR consortium
</td>
<td>
<a href="https://docs.google.com/forms/d/1Oug6GowuG1jNZNsjklXOeEvPbUrhyuS_F-d185SOy6A/">FAIR ImplementationMatrix</a>
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
<a href="https://osf.io/n7uwp/">Open Science Framework</a>
</td>
</tr>
<!-- EUDAT  -->
<tr class="odd">
<td>
EUDAT2020
</td>
<td>
<a href="https://www.edugroepen.nl/sites/RDM_platform/Shared%20Documents/Bij%20de%20WG%20Onderzoeksondersteuning%20en%20advies/How-FAIR-are-your-data.pdf">How FAIR are your data?</a>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
<a href="https://www.doi.org/10.5281/zenodo.1065990">Zenodo</a>
</td>
</tr>
<!-- Wilkinsons - MI -->
<tr class="even">
<td>
Wilkinsons et al. <span class="citation" data-cites="1GHtrFYzp">[<a href="#ref-1GHtrFYzp" role="doc-biblioref">6</a>]</span>
</td>
<td>
<a href="https://fairsharing.github.io/FAIR-Evaluator-FrontEnd/#!/">FAIR evaluation services</a>
</td>
<td>
-
</td>
<td>
Ruby on Rails
</td>
<td>
JSON, Microformat, JSSON-LD, RDFa
</td>
<td>
nanopublications
</td>
<td>
<a href="https://github.com/FAIRMetrics/Metrics/tree/master/MaturityIndicators/Gen2">GitHub</a>
</td>
</tr>
<!-- Clark -->
<tr class="odd">
<td>
Clark et al. <span class="citation" data-cites="aNdiyMUf">[<a href="#ref-aNdiyMUf" role="doc-biblioref">7</a>]</span>
</td>
<td>
<a href="https://fairshake.cloud/">FAIRshake</a>
</td>
<td>
-
</td>
<td>
Django and python
</td>
<td>
RDF
</td>
<td>
Extruct
</td>
<td>
<a href="https://github.com/MaayanLab/FAIRshake">GitHub</a>
</td>
</tr>
<thead>
<tr class="header">
<th colspan="7">
Studies assessing FAIRness of databases and repositories
</th>
</tr>
</thead>
<!-- Dunning -->
<tr class="even">
<td>
Dunning et al. <span class="citation" data-cites="171FPA92w">[<a href="#ref-171FPA92w" role="doc-biblioref">8</a>]</span>
</td>
<td>
-
</td>
<td>
x
</td>
<td>
-
</td>
<td>
-
</td>
<td>
-
</td>
<td>
<a href="https://data.4tu.nl/repository/uuid:5146dd06-98e4-426c-9ae5-dc8fa65c549f">Institutional repository</a>
</td>
</tr>
<!-- Weber -->
<tr class="odd">
<td>
Weber et al. <span class="citation" data-cites="fX0kfRFY">[<a href="#ref-fX0kfRFY" role="doc-biblioref">9</a>]</span>
</td>
<td>
-
</td>
<td>
-
</td>
<td>
python
</td>
<td>
DataCite
</td>
<td>
OAI-OMH
</td>
<td>
<a href="https://gitlab.lrz.de/ubiquando/ubiquando">GitLab</a>
</td>
</tr>
<!-- Our approach -->
<tr class="odd">
<td>
Our approach
</td>
<td>
-
</td>
<td>
x (partially)
</td>
<td>
Jupyter notebook with python
</td>
<td>
XML, JSON
</td>
<td>
request?
</td>
<td>
GitHub
</td>
</tr>
<!--
<tr class="even">
<td>Yamamoto et al. <span class="citation" data-cites="3smVei4S">[<a href="#ref-3smVei4S" role="doc-biblioref">6</a>]</span> </td>
<td>-</td>
<td>Umaka Score</td>
<td><a href="https://yummydata.org/">YummyData</a></td>
<td>Ruby on Rails</td>
<td>RDF, JSON, JSON-LD</td>
<td>SPARQL</td>
<td>-</td>
<td><a href="https://github.com/dbcls/umakadata">GitHub</a></td>
</tr>
-->
<!--
<tr class="even">
<td>Berners-Lee et al. [ref]</td>
<td>-</td>
<td>5 stars open data</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
-->
</tbody>
</table>
<!--
| Authors                                                      | Metrics                 || Platform                                                                                                                                                                                    | Automatic assessment                                                                 ||| Manual assessment| Data/code repository                                                                        |
|--------------------------------------------------------------|------|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|-----------------------------------|----------------------|------------------|---------------------------------------------------------------------------------------------|  
|                                                              | FAIR | others            |                                                                                                                                                                                             | code / language             | metadata  format                  | protocol or  library |                  |                                                                                             |
| Wilkinsons et al.                                            | x    | -                 | [FAIR evaluation services](https://fairsharing.github.io/FAIR-Evaluator-FrontEnd/#!/)                                                                                                       | Ruby on Rails               | JSON, Microformat, JSSON-LD, RDFa | nanopublications     | -                | [GitHub](https://github.com/FAIRMetrics/Metrics/tree/master/MaturityIndicators/Gen2)        |
| Clark et al. [@aNdiyMUf]                           | x    | -                 | [FAIRshake](https://fairshake.cloud/)                                                                                                                                                       | Django and python           | RDF                               | Extruct              | x                | [GitHub](https://github.com/MaayanLab/FAIRshake)                                            |
| Data Archiving and Networked Services                        | x    | -                 | [FAIR enough?](https://docs.google.com/forms/d/e/1FAIpQLSf7t1Z9IOBoj5GgWqik8KnhtH3B819Ch6lD5KuAz7yn0I0Opw/viewform) and [FAIR data assessment tool](https://www.surveymonkey.com/r/fairdat) | -                           | -                                 | -                    | x                | -                                                                                           |
| Australian Research Data Commons                             | x    | -                 | [FAIR self-assessment tool](https://www.ands-nectar-rds.org.au/fair-tool)                                                                                                                   | -                           | -                                 | -                    | x                | -                                                                                           |
| Commonwealth Scientific and Industrial Research Organization | x    | -                 | [5 star data rating tool](http://oznome.csiro.au/5star/)                                                                                                                                    | -                           | -                                 | ?                    | -                |                                                                                             |
| Shultes et al. (GO FAIR consortium)                          | x    | -                 | [FAIR ImplementationMatrix](https://docs.google.com/forms/d/1Oug6GowuG1jNZNsjklXOeEvPbUrhyuS_F-d185SOy6A/)                                                                                  | -                           | -                                 | -                    | x                | [Open ScienceFramework](https://osf.io/n7uwp/)                                              |
| Weber et al. [@fX0kfRFY]                                | x    | -                 | -                                                                                                                                                                                           | python                      | DataCite                          | OAI-OMH              | -                | [GitLab](https://gitlab.lrz.de/ubiquando/ubiquando)                                         |
| Dunning et al. [@171FPA92w]                            | x    | -                 | -                                                                                                                                                                                           | -                           | -                                 | -                    | x                | [Data repository](https://data.4tu.nl/repository/uuid:5146dd06-98e4-426c-9ae5-dc8fa65c549f) |
| Yamamoto et al. [@3smVei4S]                          | -    | Umaka Score       | [YummyData](https://yummydata.org/)                                                                                                                                                         | Ruby on Rails               | RDF, JSON, JSON-LD                | SPARQL               | -                | [GitHub](https://github.com/dbcls/umakadata)                                                |
| Berners-Lee et al. [ref]                                     | -    | 5 stars open data | -                                                                                                                                                                                           | -                           | -                                 | -                    | -                | -                                                                                           |
| Our approach                                                 | x    | -                 | -                                                                                                                                                                                           | Jupyter notebook and python | XML, JSON                         | request?             | x(partially)     | GitHub                                                                                      |


Table: Data harvesting evaluators in the literature.
{#tbl:literature}
-->
<h2 id="materials-and-methods" class="page_break_before">Materials and methods</h2>
<h3 id="use-cases-in-the-life-sciences">Use cases in the life sciences</h3>
<p>We evaluated FAIRness for two real use-cases from our department where researchers retrieve information from a repository to answer their research question. Use-case name used throughout the paper, research question, and repository or database investigated are:</p>
<ul>
<li><em>Parkinsons_AE</em>: What are the differentially expressed genes between normal subjects and subjects with Parkinson’s diseases in the brain frontal lobe? To answer this question, the researcher looked for a dataset in ArrayExpress, a repository for microarray gene expression data based at the European Bioinformatics Institute (EBI), United Kingdom <span class="citation" data-cites="IiwoLWKI">[<a href="#ref-IiwoLWKI" role="doc-biblioref">10</a>]</span>;</li>
<li><em>NBIA_GEO</em>: What is the function of mutation of WDR45 protein in the brain? In this case, the researcher looked for a dataset to analyze in Gene Expression Onmibus (GEO), a repository containing gene expression and other functional genomics data hosted at the National Center for Biotechnology Information (NCBI), United States <span class="citation" data-cites="14VfbatMA">[<a href="#ref-14VfbatMA" role="doc-biblioref">11</a>]</span>. <!--
- *TiO2_ENM*: What are the concentrations of titanium dioxide that kill cells?
  The fictitious researcher looked for an answer in eNanoMapper, a database containing physical, chemical, and biological identity of nanomaterials [@vs57YWuw];
- *Caffeine_ChEBI*: What are the biological roles of caffeine?
  In this case, the fictitious researcher looked data in ChEBI (Chemical Entities of Biological Interest), a database containing chemical entities of biological interest hosted at EBI [@stS01ivo].
--></li>
</ul>
<h3 id="what-is-data-and-what-is-metadata">What is <em>data</em> and what is <em>metadata</em>?</h3>
<p>The FAIR guidelines recursively use the terminology <em>data</em>, <em>metadata</em>, and <em>(meta)data</em>. <!-- (Table @tbl:maturity_indicators)--><br />
<!-- % , to allow certain degree of interpretation for the user [3] - [3]seminal or mons --> For our computational implementation, we needed precise definitions of these terms. Accordingly to the Merrian-Webster online dictionary, <em>data</em> are “information in digital form that can be transmitted or processed” <span class="citation" data-cites="GSsGtdV0">[<a href="#ref-GSsGtdV0" role="doc-biblioref">12</a>]</span> whereas <em>metadata</em> are “data that provides information about other data” <span class="citation" data-cites="fcdNnWId">[<a href="#ref-fcdNnWId" role="doc-biblioref">13</a>]</span>. Following these definitions, we considered the answer to the research question as <em>data</em>, and the extra information provided in the database about <em>data</em> as <em>metadata</em>. In addition, we divided <em>metadata</em> (M) in subcategories according to the requirements of the FAIR guidelines (indicated with their enumeration):</p>
<ul>
<li>M(F2): Information that allows researchers to find the dataset s/he looks for. It coincides with the keywords used in the search;</li>
<li>M(F3): Data identifier in the repository;<br />
</li>
<li>M(I3): Reference to other metadata;</li>
<li>M(R1): Further information about data content, other than the search keywords;</li>
<li>M(R1.1): Data license;</li>
<li>M(R1.2): Data provenance: author name, publication title, and one author’s email address. <!--    %See https://blog.datacite.org/exposing-doi-metadata-provenance/ with DOI https://doi.org/10.5438/wy92-xj57 --></li>
</ul>
<p>Metadata corresponding to guidelines F2 and R1 change with the research question, while the remaining metadata are independent from the research question. We did not define M(1.3) as it requires community consensus. In all cases, we assumed that <em>data</em> and <em>metadata</em> were hosted in the same repository.</p>
<h3 id="calculating-fair-maturity-indicators">Calculating FAIR maturity indicators</h3>
<p>Because the FAIR guidelines stress on the importance of <em>data</em> and <em>metadata</em> being “machine-readable”, we collected information about datasets and repositories via application programming interface (API) wherever possible.<br />
We retrieved information from three different sources:</p>
<ul>
<li>Repositories (ArrayExpress and Gene Expression Omnibus): We programmatically queried each repository using the same keywords that researchers had used in their manual query. From the obtained metadata, we retrieved information to calculate maturity indicators for the principles F2, F3, I1, I3, R1, and R12;</li>
<li>Registry of repository: We queried <a href="www.re3data.org">re3data.org</a>, a registry containing information about more than 2000 data repositories from various disciplines. We used the retrieved information to computed the maturity indicators for the principles F1, A2, and R12;<br />
</li>
<li>Searchable resource: We queried <a href="https://toolbox.google.com/datasetsearch">Google Dataset Search</a>, an emerging search engine specific for datasets, to quantify the principle F4.</li>
</ul>
<p>The output of queries consisted of xml structured information, which we vectorized for easier string finding. Details about the computation of each specific maturity indicator are in Table <a href="#maturity_indicators">2</a> and in the Jupyter notebook (interactive on binder). To each maturity indicator, we assigned value 1 if the criterion was satisfied, 0 in the opposite case. The only exception is the maturity indicator related to F2, which we calculated as the ratio between the number of keywords in the dataset metadata and the total number of keywords used by the researcher in the manual query.</p>
<!--We represented the state of maturity indicators using balloon plots (Fig. @fig:outcome_comparison), where the area of each point corresponds to the level of maturity indicator.-->
<a name="maturity_indicators"></a>
<table style="width:100%;">
<caption>
<span>Table 2:</span> FAIR principles and evaluation criteria used by the promoters, a qualitative analysis, a quantitative calculation, and our approach.<br />
In our approach, <em>dataset</em> metadata refers to metadata retrieved from ArrayExpress and Gene Expression Omnibus, whereas <em>registry</em> metadata to metadata retrieved from re3data.<br />
Acronyms: GUID = Globally Unique IDentifier, A = automatic information retrieval, M = manual information retrieval.
</caption>
<colgroup>
<col style="width: 19%" />
<!-- Principle-->
<col style="width: 19%" />
<!-- Wilkinson -->
<col style="width: 19%" />
<!-- Dunning -->
<col style="width: 19%" />
<!-- Weber-->
<col style="width: 19%" />
<!-- Our approach-->
</colgroup>
<thead>
<tr class="header">
<th>
FAIR principle <span class="citation" data-cites="6DjakjNS">[<a href="#ref-6DjakjNS" role="doc-biblioref">3</a>]</span>
</th>
<th>
Wilkinson et al. <span class="citation" data-cites="1GHtrFYzp">[<a href="#ref-1GHtrFYzp" role="doc-biblioref">6</a>]</span>
</th>
<th>
Dunning et al. <span class="citation" data-cites="171FPA92w">[<a href="#ref-171FPA92w" role="doc-biblioref">8</a>]</span>
</th>
<th>
Weber et al. <span class="citation" data-cites="fX0kfRFY">[<a href="#ref-fX0kfRFY" role="doc-biblioref">9</a>]</span>
</th>
<th>
Our approach
</th>
</tr>
</thead>
<tbody>
<!-- F1 -->
<tr class="odd">
<td>
F1: (meta)data are assigned a globally unique and persistent identifier
</td>
<td>
The GUID matches a scheme that is globally unique and persistent in FAIRsharing
</td>
<td>
Persistent identifier is DOI or similar
</td>
<td>
Pass
</td>
<td>
“doi” icon is enabled in www.re3data.org (M)
</td>
</tr>
<!-- F2 -->
<tr class="even">
<td>
F2: data are described with rich metadata (defined by R1 below)
</td>
<td>
Metadata contains “structured” elements (micrograph, JSON) or linked data (JSON-LD, RDFa)
</td>
<td>
Title, creator, date, contributors, keywords, temporal and spatial coverage
</td>
<td>
Q <sub>geo</sub>, Q <sub>chrono</sub>
</td>
<td>
Search keywords are in <em>dataset</em> metadata (A)
</td>
</tr>
<!-- F3 -->
<tr class="odd">
<td>
F3: metadata clearly and explicitly include the identifier of the data it describes
</td>
<td>
Metadata contains both its own GUID and the data GUID
</td>
<td>
DOI of data is in metadata
</td>
<td>
Pass
</td>
<td>
<em>Dataset</em> metadata contains dataset ID (A)
</td>
</tr>
<!-- F4 -->
<tr class="even">
<td>
F4: (meta)data are registered or indexed in a searchable resource
</td>
<td>
The digital resource can be found using web-based search engines
</td>
<td>
Dataset title found in google.com or duckduckgo.com
</td>
<td>
Pass
</td>
<td>
Dataset title found in Google Dataset Search (A)
</td>
</tr>
<!-- A1 -->
<tr class="odd">
<td>
A.1 (meta)data are retrievable by their identifier using a standardized communications protocol
</td>
<td>
N/A
</td>
<td>
HTTP request returns 200
</td>
<td>
Q <sub>ret</sub>
</td>
<td>
HTTP request returns 200 (A)
</td>
</tr>
<!-- A1.1 -->
<tr class="even">
<td>
A1.1 the protocol is open, free, and universally implementable
</td>
<td>
The resolution protocol is universally implementable with an open protocol
</td>
<td>
Accomplished if protocol is HTTP
</td>
<td>
Q <sub>ret</sub>
</td>
<td>
Accomplished if protocol is HTTP (A)
</td>
</tr>
<!-- A1.2 -->
<tr class="odd">
<td>
A1.2 the protocol allows for an authentication and authorization procedure, where necessary
</td>
<td>
The resolution protocol supports authentication and authorization for access to restricted content
</td>
<td>
Accomplished if protocol is HTTP
</td>
<td>
Q <sub>ret</sub>
</td>
<td>
Accomplished if protocol is HTTP (A)
</td>
</tr>
<!-- A2 -->
<tr class="even">
<td>
A2. metadata are accessible, even when the data are no longer available
</td>
<td>
There is a policy for metadata
</td>
<td>
Repository has a clear policy statement
</td>
<td>
N/A
</td>
<td>
“data availability policy” is completed in <em>registry</em> metadata (A)
</td>
</tr>
<!-- I1 -->
<tr class="odd">
<td>
I1. (meta)data use a formal, accessible, shared, and broadly applicable language for knowledge representation
</td>
<td>
If hash-style metadata (e.g. JSON) or Linked Data are found, pass
</td>
<td>
Metadata is structured (e.g. Dublin Core)
</td>
<td>
Pass
</td>
<td>
<em>Dataset</em> metadata is structured (e.g. xml) (M)
</td>
</tr>
<!-- I2 -->
<tr class="even">
<td>
I2. (meta)data use vocabularies that follow FAIR principles
</td>
<td>
(meta)data uses vocabularies that are, themselves, FAIR
</td>
<td>
N/A
</td>
<td>
N/A
</td>
<td>
N/A
</td>
</tr>
<!-- I3 -->
<tr class="odd">
<td>
I3. (meta)data include qualified references to other (meta)data
</td>
<td>
Metadata contain links that are not from the same source (domain/host)
</td>
<td>
Links to publications and terms definitions
</td>
<td>
N/A
</td>
<td>
<em>Dataset</em> metadata includes reference to other dataset IDs (A)
</td>
</tr>
<!-- R1 -->
<tr class="even">
<td>
R1. meta(data) are richly described with a plurality of accurate and relevant attributes
</td>
<td>
N/A
</td>
<td>
Metadata provide information on how to reuse a dataset
</td>
<td>
Q <sub>geo</sub>, Q <sub>chrono</sub>
</td>
<td>
<em>Dataset</em> metadata contain more information than search keywords (F2) (A)
</td>
</tr>
<!-- R1.1 -->
<tr class="odd">
<td>
R1.1. (meta)data are released with a clear and accessible data usage license
</td>
<td>
Metadata contains a pointer to the data license
</td>
<td>
Metadata license is present
</td>
<td>
Q <sub>lic</sub>
</td>
<td>
“datalicensename” and “datalicenseulr” are filled in <em>registry</em> metadata (A)
</td>
</tr>
<!-- R1.2 -->
<tr class="even">
<td>
R1.2. (meta)data are associated with detailed provenance
</td>
<td>
N/A
</td>
<td>
Documentation on how data was created
</td>
<td>
N/A
</td>
<td>
“authors”, “email” and “title” are filled in <em>dataset</em> metadata (A)
</td>
</tr>
<!-- R1.3 -->
<tr class="odd">
<td>
R1.3. (meta)data meet domain-relevant community standards
</td>
<td>
N/A
</td>
<td>
N/A
</td>
<td>
N/A
</td>
<td>
N/A
</td>
</tr>
</tbody>
</table>
<h3 id="visualizing-fair-maturity-indicators">Visualizing FAIR maturity indicators</h3>
<p>To summarize and compare the outputs of our calculation, we created a balloon plots using the R library ggplot2 <span class="citation" data-cites="9ZeJmRhV">[<a href="#ref-9ZeJmRhV" role="doc-biblioref">14</a>]</span>.<br />
In the graph, each row corresponds to a user-case and each column to FAIR maturity indicator. The size of each shape is the value of a specific FAIR maturity indicator for a particular dataset. Squares represent maturity indicators determined manually, circles are for maturity indicators established automatically, and crosses for not computed maturity indicators. Finally, colors represent a group of principles of the acronym: blue for findable, red for accessible, green for interoperable, and orange for reusable. We used grey for non evaluated metrics.</p>
<!--
|                                                                                                               | Wilkinson [@nbCfpQJk]              | Dunning [@171FPA92w]                                                  | Weber [@fX0kfRFY]                                 | Our approach                                      |                 
|---------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|--------------------------------------------------------|---------------------------------------------------|
| F1: (meta)data are assigned a globally unique and persistent identifier                                       | The GUID matches a scheme that is globally unique and persistent in FAIRsharing                          | Persistent identifier is DOI or similar                                     | Pass                                                   | Information from re3data *                        |
| F2: data are described with rich metadata (defined by R1 below)                                               | Metadata contains "structured" elements (micrograph, JSON) or linked data (JSON-LD, RDFa)                | Title, creator, date, contributors, keywords, temporal and spatial coverage | Q <sub>geo</sub>, Q <sub>chrono</sub>                  | Search keywords are in metadata                   |
| F3: metadata clearly and explicitly include the identifier of the data it describes                           | Metadata contains both its own GUID and the data GUID                                                    | DOI of data is in metadata                                                  | Pass                                                   | Metadata contains dataset ID found with search    |            
| F4: (meta)data are registered or indexed in a searchable resource                                             | The digital resource can be found using web-based search engines                                         | Dataset title searched in google.com or duckduckgo.com                      | Pass                                                   | Dataset title searched in [Google Dataset Search](https://toolbox.google.com/datasetsearch)|
| A.1 (meta)data are retrievable by their identifier using a standardized communications protocol               | -                                                                                                        | If HTTP, pass                                                               | Q <sub>ret</sub>                                       | HTTP request returns 200                          |                                                                                    |
| A1.1 the protocol is open, free, and universally implementable                                                | The resolution protocol is universally implementable with an open protocol                               | If HTTP, pass                                                               | Q <sub>ret</sub>                                       | Included in A.1                                   |
| A1.2 the protocol allows for an authentication and authorization procedure, where necessary                   | The resolution protocol supports authentication and authorization for access to restricted content       | If HTTP, pass                                                               | Q <sub>ret</sub>                                       | Included in A.1                                   |
| A2. metadata are accessible, even when the data are no longer available                                       | There is a policy for metadata | Repository has a clear policy statement                                 | -                                                                           | Manual check or on re3data                             | Asked to repositories *                           |
| I1. (meta)data use a formal, accessible, shared, and broadly applicable language for knowledge representation | If hash-style metadata (e.g. JSON) or Linked Data are found, pass                                        | Metadata is structured (e.g. Dublin Core)                                   | Pass                                                   | Metadata are in a defined structure *             |
| I2. (meta)data use vocabularies that follow FAIR principles                                                   | (meta)data uses vocabularies that are, themselves, FAIR                                                  | -                                                                           | -                                                      | -                                                 |
| I3. (meta)data include qualified references to other (meta)data                                               | Metadata contain links that are not from the same source (domain/host)                                   | Links to publications and terms definitions                                 | -                                                      | Metadata includes reference to other dataset IDs  |
| R1. meta(data) are richly described with a plurality of accurate and relevant attributes                      | -                                                                                                        | Metadata provide information on how to reuse a dataset                      | Q <sub>geo</sub>, Q <sub>chrono</sub>                  | TBD      |
| R1.1. (meta)data are released with a clear and accessible data usage license                                  | Metadata contains a pointer to the data license                                                          | Metadata license is present                                                 | Q <sub>lic</sub> | Check on re3data.org                | Information from re3data *                        |
| R1.2. (meta)data are associated with detailed provenance                                                      | -                                                                                                        | Documentation on how data was created                                       | -                                                      | Author name, email address, publication           |
| R1.3. (meta)data meet domain-relevant community standards                                                     | -                                                                                                        | -                                                                           | -                                                      | -                                                 |

Table: FAIR maturity indicators. In our approach, manual procedures are labelled with \*.  
Acronyms: GUID = Globally Unique IDentifier.
{#tbl:maturity_indicators}

-->
<h2 id="results" class="page_break_before">Results</h2>
<p>For both use-cases, metadata contain all keywords used in the manual search (F2), dataset unique identifiers (F3), and additional information for data reuse (R1). In addition, they are structured in <code>xml</code> format (I1) and are released with a clear usage license (R11). The protocol (HTTP) used to retrieved all information is standardized (A1), open, free and universally implementable (A11), and allows for authentication where needed (A12). In both cases, dataset metadata are not assigned a persistent identifiers (F1) and do not reference to other metadata (I3). Finally, the dataset of the use-case <em>Parkinson_AE</em> is found in Google Dataset Search (F4) and has detailed provenance (R12), whereas the dataset <em>NBIA_GEO</em> does not. Comparative summary of results is in Figure <a href="#fig:outcome_comparison">1</a>, whereas details of findings are in Table <a href="#results">3</a>.</p>
<figure>
<img src="images/outcome_comparison.png" alt="Figure 1: Comparative summary of FAIR maturity indicators for the two use cases evaluated in this work. Shape size corresponds to the numerical value of mutual indicators, colors represent FAIR categories, and shapes illustrate the way we retrieved information (N/A = not available). The graph can be fully reproduced from our Jupyter notebook on GitHub and interactively in binder." id="fig:outcome_comparison" style="width:100.0%" /><figcaption><span>Figure 1:</span> Comparative summary of FAIR maturity indicators for the two use cases evaluated in this work. Shape size corresponds to the numerical value of mutual indicators, colors represent FAIR categories, and shapes illustrate the way we retrieved information (N/A = not available). The graph can be fully reproduced from our <a href="">Jupyter notebook</a> on GitHub and interactively in <a href="">binder</a>.</figcaption>
</figure>
<a name="results"></a>
<table style="width:100%;">
<caption>
<span>Table 3:</span> Comparison of API systems and FAIR maturity indicators for the two uses cases analyzed in this work. For each maturity indicator, we indicate the outcome in natural language and in numbers (1 for pass and 0 for fail).
</caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 40%" />
<col style="width: 40%" />
<!--
<col style="width: 19%" />
<col style="width: 19%" />
-->
</colgroup>
<thead>
<tr class="header">
<th>
Use case
</th>
<th>
Parkinsons_AE
</th>
<th>
NBIA_GEO
</th>
<!--
<th>
TiO2_ENM
</th>
<th>
Caffeine_ChEBI
</th>
-->
</tr>
</thead>
<tbody>
<!-- Repository -->
<tr class="odd">
<td>
Repository / Database
</td>
<td>
<a href="https://www.ebi.ac.uk/arrayexpress/">Array Express</a>
</td>
<td>
<a href="https://www.ncbi.nlm.nih.gov/geo/">Gene Expression Omnibus</a>
</td>
<!--
<td>
<a href="https://data.enanomapper.net/">eNanoMapper</a>
</td>
<td>
<a href="https://www.ebi.ac.uk/chebi/">ChEBI</a>
</td>
-->
</tr>
<!-- Search output on browser -->
<tr class="even">
<td>
Search output on browser
</td>
<td>
<a href="https://www.ebi.ac.uk/arrayexpress/experiments/E-MTAB-1194/">link</a>
</td>
<td>
<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE70433">link</a>
</td>
<td>
<!--
<a href="https://data.enanomapper.net/substance/XLSX-7011cea0-1011-3f8b-9e8a-b3289fed836a/study">link</a>
</td>
<td>
<a href="https://www.ebi.ac.uk/chebi/searchId.do?chebiId=CHEBI:27732">link</a>
</td>
-->
</tr>
<!-- API -->
<thead>
<tr class="header">
<th colspan="3">
API
</th>
</tr>
</thead>
<!-- API type -->
<tr class="even">
<td>
Type
</td>
<td>
REST
</td>
<td>
REST <!--
</td>
<td>
REST
</td>
<td>
SOAP
</td>
-->
</tr>
<!-- API documentation -->
<tr class="odd">
<td>
Documentation
</td>
<td>
<a href="https://www.ebi.ac.uk/arrayexpress/help/programmatic_access.html">link</a>
</td>
<td>
<a href="https://www.ncbi.nlm.nih.gov/geo/info/geo_paccess.html">link</a>
</td>
<!--
<td>
<a href="http://enanomapper.github.io/API/">link</a>
</td>
<td>
<a href="https://www.ebi.ac.uk/chebi/webServices.do">link</a>
</td>
-->
</tr>
<!-- Output format -->
<tr class="even">
<td>
Output format
</td>
<td>
XML
</td>
<td>
XML
</td>
<!--
<td>
RDF
</td>
<td>
XML
</td>
-->
</tr>
<!-- FAIR -->
<thead>
<tr class="header">
<th colspan="3">
FAIR maturity indicators
</th>
</tr>
</thead>
<!-- F1 -->
<tr class="even">
<td>
F1 (Persistent identifier)
</td>
<td>
No (0)
</td>
<td>
No (0)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- F2 -->
<tr class="odd">
<td>
F2 (Findable metadata)
</td>
<td>
Parkinson’s disease, normal, homo sapiens, transcription profiling by array, raw data, frontal lobe, male, female (1)
</td>
<td>
nbia, homo sapiens, expression profiling by array (1)
</td>
<!--
<td>
Publication and protocol
</td>
<td>
</td>
-->
</tr>
<!-- F3 -->
<tr class="even">
<td>
F3 (Unique identifier)
</td>
<td>
219251 (1)
</td>
<td>
200070433 (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- F4 -->
<tr class="odd">
<td>
F4 (Google Dataset Search)
</td>
<td>
Yes (1)
</td>
<td>
No (0)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- A1 -->
<tr class="even">
<td>
A1 (Communication protocol)
</td>
<td>
request status code = 200 (1)
</td>
<td>
request status code = 200 (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- A11 -->
<tr class="even">
<td>
A11 (Open and free protocol)
</td>
<td>
Yes (1)
</td>
<td>
Yes (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- A12 -->
<tr class="even">
<td>
A12 (Communication protocol)
</td>
<td>
Yes (1)
</td>
<td>
Yes (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- A2 -->
<tr class="odd">
<td>
A2 (Metadata always accessible)
</td>
<td>
Yes (1)
</td>
<td>
No (0)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- I1 -->
<tr class="even">
<td>
I1 (Language representation)
</td>
<td>
XML (1)
</td>
<td>
XML (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- I2 -->
<tr class="odd">
<td>
I2 (FAIR vocabularies)
</td>
<td>
Not evaluated (None)
</td>
<td>
Not evaluated (None)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- I3 -->
<tr class="even">
<td>
I3 (Reference to other metadata)
</td>
<td>
No (0)
</td>
<td>
No (0)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- R1 -->
<tr class="odd">
<td>
R1 (Metadata for reuse)
</td>
<td>
56 metadata field (1)
</td>
<td>
58 metadata field (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- R11 -->
<tr class="even">
<td>
R1.1 (License)
</td>
<td>
name: other <br> url: <a href="https://www.ebi.ac.uk/arrayexpress/help/data_availability.html">https://www.ebi.ac.uk/arrayexpress/help/data_availability.html</a> (1)
</td>
<td>
name: other <br> url: <a href="http://www.ncbi.nlm.nih.gov/geo/info/disclaimer.html">http://www.ncbi.nlm.nih.gov/geo/info/disclaimer.html</a> (1)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- R12 -->
<tr class="odd">
<td>
R1.2 (Provenance)
</td>
<td>
Authors: Garcia-Esparcia P, Schlüter A, Carmona M, Moreno J, Snsoleaga B, Torrejón-Escribano B, Gustincich S, Pujol A, Ferrer I <br> Email: aschluter@idibell.org <br> Title: Functional genomics reveals dysregulation of cortical olfactory receptors in parkinson disease: novel putative chemoreceptors in the human brain (1)
</td>
<td>
No (0)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
<!-- R3 -->
<tr class="even">
<td>
R1.3 (Community standards)
</td>
<td>
Not evaluated (None)
</td>
<td>
Not evaluated (None)
</td>
<!--
<td>
</td>
<td>
</td>
-->
</tr>
</tbody>
</table>
<h2 id="discussion" class="page_break_before">Discussion</h2>
<p>Still work in progress</p>
<p>In this work, we present a workflow to compute FAIR maturity indicators for two use-cases of dataset retrieval in the life sciences.</p>
<p><strong>How we calculated the metrics</strong> <!--
The interpretation of the FAIR principles was not always trivial. Given that they are vague by definition, we had to take decision. We based our decisions on the principles themselves,
the interpretation by the authors of the metrics and two previous studies that computed FAIR maturity indicators on a large
--></p>
<ul>
<li>Comparison to Wilkinson: Our metrics do not start with metadata GUID (general user identifier) (see gen2) but with the researcher’s question. Using GUID implies that the researcher has already found the dataset of interest<br />
</li>
<li>Compare to Weber and Dunning<br />
</li>
<li>We used re3data and not FAIRsharing because the last one does not provide API</li>
<li>Limitations: A1, A11, A12: retrieve information only via HTTP, so they are all true. If data is on a local excel file or database, then we need a different implementation</li>
<li>Limitation of manual :We searched manually as Google Dataset Search does not have an API.</li>
<li>NO final score because</li>
<li>Comments on the findings</li>
</ul>
<p><strong>Visualization</strong> - We chose to plot our results instead of providing a final score to avoid negative connotations (see FAIR metrics vs. maturity indicators). However, we wanted to be able to compare our results, so we used balloon plots, usually used for categorical data visualization and comparison. (FAIR shake uses visualizations too but they are not comparable)</p>
<p><strong>Reproducibility</strong> - We chose to use Jupyter notebooks for reproducibility of our results. However, databases change but they do not provide versions. Therefore, we can just declare the time stamps when our query was done. In addition, Jupyter notebooks are both machine and human readable, and easier to export to other domains that do not use specifically programming languages designed for the web</p>
<p><strong>Difficulty / Limitations</strong> Different repositories use different data structure. Automatization occurs after a lot of manual investigation - We had to adapt the code based on API type and response schema. Our implementation requires specific knowledge of the database structure and thus it is difficult to directly generalize it to various databases<br />
- We considered use cases where all queries provided one final dataset. In real practice, researchers often need to compare subset of retrieved datasets manually because there are not enough information to discriminate them computationally (the information is present, but not machine-readable)<br />
Our implementation requires specific knowledge of the database structure and thus it is difficult to directly generalize it to various databases.<br />
Different repositories use different html tags to define their - Database APIs do not allow to retrieve all the information that the user interface allows (example 1: ChEBI does not allow to retrieve information about reactions; example 2: Array Express has some metadata in tables that must be downloaded locally before being queried</p>
<h2 id="acknowledgments" class="page_break_before">Acknowledgments</h2>
<p>The NanoSolveIT project is funded by the European Union grant xxx. The RiskGONE project is funded by the European Union grant 814425 — RiskGONE — H2020-NMBP-TO-IND-2018-2020 NMBP-13-2018 RIA. We would like to thank Nasim B. Sangani, Gwen Keulen, and Friederike Ehrhart for the use cases, and Tobias Weber for the insightful discussion about data retrieval. This manuscript was created with manubot <span class="citation" data-cites="OvL2rC9o">[<a href="#ref-OvL2rC9o" role="doc-biblioref">15</a>]</span>.</p>
<h2 id="references" class="page_break_before">References</h2>
<!-- Explicitly insert bibliography here -->
<div id="refs" role="doc-bibliography">
<div id="ref-xf44BZw9">
<p>1. <strong>Credit data generators for data reuse</strong><br />
Heather H. Pierce, Anurupa Dev, Emily Statham, Barbara E. Bierer<br />
<em>Nature</em> (2019-06) <a href="https://doi.org/gf3j9t">https://doi.org/gf3j9t</a><br />
DOI: <a href="https://doi.org/10.1038/d41586-019-01715-4">10.1038/d41586-019-01715-4</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/31164773">31164773</a></p>
</div>
<div id="ref-D6wjcBsJ">
<p>2. <strong>What is Data Retrieval? - Definition from Techopedia</strong><br />
Techopedia.com<br />
<a href="https://www.techopedia.com/definition/30140/data-retrieval">https://www.techopedia.com/definition/30140/data-retrieval</a></p>
</div>
<div id="ref-6DjakjNS">
<p>3. <strong>The FAIR Guiding Principles for scientific data management and stewardship</strong><br />
Mark D. Wilkinson, Michel Dumontier, IJsbrand Jan Aalbersberg, Gabrielle Appleton, Myles Axton, Arie Baak, Niklas Blomberg, Jan-Willem Boiten, Luiz Bonino da Silva Santos, Philip E. Bourne, … Barend Mons<br />
<em>Scientific Data</em> (2016-03-15) <a href="https://doi.org/bdd4">https://doi.org/bdd4</a><br />
DOI: <a href="https://doi.org/10.1038/sdata.2016.18">10.1038/sdata.2016.18</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/26978244">26978244</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4792175">PMC4792175</a></p>
</div>
<div id="ref-u8Cy0psL">
<p>4. <strong>Cloudy, increasingly FAIR; revisiting the FAIR Data guiding principles for the European Open Science Cloud</strong><br />
Barend Mons, Cameron Neylon, Jan Velterop, Michel Dumontier, Luiz Olavo Bonino da Silva Santos, Mark D. Wilkinson<br />
<em>Information Services &amp; Use</em> (2017-03-07) <a href="https://doi.org/gfkrrv">https://doi.org/gfkrrv</a><br />
DOI: <a href="https://doi.org/10.3233/ISU-170824">10.3233/isu-170824</a></p>
</div>
<div id="ref-14foUQTpW">
<p>5. <strong>A design framework and exemplar metrics for FAIRness</strong><br />
Mark D. Wilkinson, Susanna-Assunta Sansone, Erik Schultes, Peter Doorn, Luiz Olavo Bonino da Silva Santos, Michel Dumontier<br />
<em>Scientific Data</em> (2018-06-26) <a href="https://doi.org/gfkrrt">https://doi.org/gfkrrt</a><br />
DOI: <a href="https://doi.org/10.1038/sdata.2018.118">10.1038/sdata.2018.118</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/29944145">29944145</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6018520">PMC6018520</a></p>
</div>
<div id="ref-1GHtrFYzp">
<p>6. <strong>Evaluating FAIR Maturity Through a Scalable, Automated, Community-Governed Framework</strong><br />
Mark D Wilkinson, Michel Dumontier, Susanna-Assunta Sansone, Luiz Olavo Bonino da Silva Santos, Mario Prieto, Dominique Batista, Peter McQuilton, Tobias Kuhn, Philippe Rocca-Serra, Mercè Crosas, Erik Schultes<br />
<em>Cold Spring Harbor Laboratory</em> (2019-05-28) <a href="https://doi.org/gf492b">https://doi.org/gf492b</a><br />
DOI: <a href="https://doi.org/10.1101/649202">10.1101/649202</a></p>
</div>
<div id="ref-aNdiyMUf">
<p>7. <strong>FAIRshake: toolkit to evaluate the findability, accessibility, interoperability, and reusability of research digital resources</strong><br />
Daniel J. B. Clarke, Lily Wang, Alex Jones, Megan L. Wojciechowicz, Denis Torre, Kathleen M. Jagodnik, Sherry L. Jenkins, Peter McQuilton, Zachary Flamholz, Moshe C. Silverstein, … Avi Ma’ayan<br />
<em>Cold Spring Harbor Laboratory</em> (2019-06-03) <a href="https://doi.org/gf4cm8">https://doi.org/gf4cm8</a><br />
DOI: <a href="https://doi.org/10.1101/657676">10.1101/657676</a></p>
</div>
<div id="ref-171FPA92w">
<p>8. <strong>Are the FAIR Data Principles fair?</strong><br />
Alastair Dunning, Madeleine De Smaele, Jasmin Böhmer<br />
<em>International Journal of Digital Curation</em> (1970-01-01) <a href="https://doi.org/gf4bnb">https://doi.org/gf4bnb</a><br />
DOI: <a href="https://doi.org/10.2218/ijdc.v12i2.567">10.2218/ijdc.v12i2.567</a></p>
</div>
<div id="ref-fX0kfRFY">
<p>9. <strong>How FAIR Can you Get? Image Retrieval as a Use Case to Calculate FAIR Metrics</strong><br />
Tobias Weber, Dieter Kranzlmuller<br />
<em>2018 IEEE 14th International Conference on e-Science (e-Science)</em> (2018-10) <a href="https://doi.org/gf4bm9">https://doi.org/gf4bm9</a><br />
DOI: <a href="https://doi.org/10.1109/escience.2018.00027">10.1109/escience.2018.00027</a></p>
</div>
<div id="ref-IiwoLWKI">
<p>10. <strong>ArrayExpress–a public repository for microarray gene expression data at the EBI</strong><br />
A. Brazma<br />
<em>Nucleic Acids Research</em> (2003-01-01) <a href="https://doi.org/fvff5t">https://doi.org/fvff5t</a><br />
DOI: <a href="https://doi.org/10.1093/nar/gkg091">10.1093/nar/gkg091</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/12519949">12519949</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC165538">PMC165538</a></p>
</div>
<div id="ref-14VfbatMA">
<p>11. <strong>Gene Expression Omnibus: NCBI gene expression and hybridization array data repository</strong><br />
R. Edgar<br />
<em>Nucleic Acids Research</em> (2002-01-01) <a href="https://doi.org/fttpkn">https://doi.org/fttpkn</a><br />
DOI: <a href="https://doi.org/10.1093/nar/30.1.207">10.1093/nar/30.1.207</a> · PMID: <a href="https://www.ncbi.nlm.nih.gov/pubmed/11752295">11752295</a> · PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC99122">PMC99122</a></p>
</div>
<div id="ref-GSsGtdV0">
<p>12. <strong>Definition of DATA</strong><a href="https://www.merriam-webster.com/dictionary/data">https://www.merriam-webster.com/dictionary/data</a></p>
</div>
<div id="ref-fcdNnWId">
<p>13. <strong>Definition of METADATA</strong><a href="https://www.merriam-webster.com/dictionary/metadata">https://www.merriam-webster.com/dictionary/metadata</a></p>
</div>
<div id="ref-9ZeJmRhV">
<p>14. <strong>ggplot2</strong><br />
Hadley Wickham<br />
<em>Springer New York</em> (2009) <a href="https://doi.org/djmzjq">https://doi.org/djmzjq</a><br />
DOI: <a href="https://doi.org/10.1007/978-0-387-98141-3">10.1007/978-0-387-98141-3</a></p>
</div>
<div id="ref-OvL2rC9o">
<p>15. <strong>manubot/rootstock GitHub repository</strong><br />
Daniel Himmelstein<br />
<em>GitHub</em> (2019) <a href="https://github.com/manubot/rootstock">https://github.com/manubot/rootstock</a></p>
</div>
</div>
<!-- default theme -->

<style>
    /* import google fonts */
    @import url("https://fonts.googleapis.com/css?family=Open+Sans:400,600,700");
    @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

    /* -------------------------------------------------- */
    /* global */
    /* -------------------------------------------------- */

    /* all elements */
    * {
        /* force sans-serif font unless specified otherwise */
        font-family: "Open Sans", "Helvetica", sans-serif;

        /* prevent text inflation on some mobile browsers */
        -webkit-text-size-adjust: none !important;
        -moz-text-size-adjust: none !important;
        -o-text-size-adjust: none !important;
        text-size-adjust: none !important;
    }

    @media only screen {
        /* "page" element */
        body {
            position: relative;
            box-sizing: border-box;
            font-size: 12pt;
            line-height: 1.5;
            max-width: 8.5in;
            margin: 20px auto;
            padding: 40px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* "page" element */
        body {
            padding: 20px;
            margin: 0;
            border-radius: 0;
            border: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
            background: none;
        }
    }

    /* -------------------------------------------------- */
    /* headings */
    /* -------------------------------------------------- */

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 20px 0;
        padding: 0;
        font-weight: bold;
    }

    /* biggest heading */
    h1 {
        margin: 40px 0;
        text-align: center;
    }

    /* second biggest heading */
    h2 {
        margin-top: 30px;
        padding-bottom: 5px;
        border-bottom: solid 1px #bdbdbd;
    }

    /* -------------------------------------------------- */
    /* manuscript header */
    /* -------------------------------------------------- */

    /* manuscript title */
    header > h1 {
        margin: 0;
    }

    /* manuscript title caption text (ie "automatically generated on") */
    header + p {
        text-align: center;
        margin-top: 10px;
    }

    /* -------------------------------------------------- */
    /* text elements */
    /* -------------------------------------------------- */

    /* links */
    a {
        color: #2196f3;
    }

    /* normal links (not empty, not button link, not syntax highlighting link) */
    a:not(:empty):not(.button):not(.sourceLine) {
        padding-left: 1px;
        padding-right: 1px;
    }

    /* superscripts and subscripts */
    sub,
    sup {
        /* prevent from affecting line height */
        line-height: 0;
    }

    /* unordered and ordered lists*/
    ul,
    ol {
        padding-left: 20px;
    }

    /* class for styling text semibold */
    .semibold {
        font-weight: 600;
    }

    /* class for styling elements horizontally left aligned */
    .left {
        display: block;
        text-align: left;
        margin-left: auto;
        margin-right: 0;
        justify-content: left;
    }

    /* class for styling elements horizontally centered */
    .center {
        display: block;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
        justify-content: center;
    }

    /* class for styling elements horizontally right aligned */
    .right {
        display: block;
        text-align: right;
        margin-left: 0;
        margin-right: auto;
        justify-content: right;
    }

    /* -------------------------------------------------- */
    /* section elements */
    /* -------------------------------------------------- */

    /* horizontal divider line */
    hr {
        border: none;
        height: 1px;
        background: #bdbdbd;
    }

    /* paragraphs, horizontal dividers, figures, tables, code */
    p,
    hr,
    figure,
    table,
    pre {
        /* treat all as "paragraphs", with consistent vertical margins */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* figures */
    /* -------------------------------------------------- */

    /* figure */
    figure {
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure caption */
    figcaption {
        padding: 0;
        padding-top: 10px;
        font-size: 0.60em;    /* added by Serena - set size relative to main document font-size */
    }

    /* figure image element */
    figure img {
        max-width: 100%;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    /* figure auto-number */
    img + figcaption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* tables */
    /* -------------------------------------------------- */

    /* table */
    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        font-size: 0.60em;    /* added by Serena - set size relative to main document font-size */
        table-layout: fixed;  /* added by Serena */
        width: 8.5in;         /* added by Serena */
    }

    table td { /* added by Serena */
        word-wrap: break-word;         /* All browsers since IE 5.5+ */
        overflow-wrap: break-word;     /* Renamed property in CSS3 draft spec */
    }
    /* table cells */
    th,
    td {
        border: solid 1px #bdbdbd;
        padding: 5px; /*padding: 10px; changed by Serena*/
        /* squash table if too wide for page by forcing line breaks */
        word-break: break-all;
        word-break: break-word;
    }

    /* header row and even rows */
    th,
    tr:nth-child(2n) {
        background-color: #fafafa;
    }

    /* odd rows */
    tr:nth-child(2n + 1) {
        background-color: #ffffff;
    }

    /* table caption */
    caption {
        text-align: left;
        padding: 0;
        padding-bottom: 10px;
    }

    /* table auto-number */
    table > caption > span:first-of-type,
    div.table_wrapper > table > caption > span:first-of-type {
        font-weight: bold;
        margin-right: 5px;
    }

    /* -------------------------------------------------- */
    /* code */
    /* -------------------------------------------------- */

    /* multi-line code block */
    pre {
        padding: 10px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
        break-inside: avoid;
        text-align: left;
    }

    /* inline code, ie code within normal text */
    :not(pre) > code {
        padding: 0 4px;
        background-color: #eeeeee;
        color: #000000;
        border-radius: 5px;
    }

    /* code text */
    /* apply all children, to reach syntax highlighting sub-elements */
    code,
    code * {
        /* force monospace font */
        font-family: "Source Code Pro", "Courier New", monospace;
    }

    /* -------------------------------------------------- */
    /* quotes */
    /* -------------------------------------------------- */

    /* quoted text */
    blockquote {
        margin: 0;
        padding: 0;
        border-left: 4px solid #bdbdbd;
        padding-left: 16px;
        break-inside: avoid;
    }

    /* -------------------------------------------------- */
    /* banners */
    /* -------------------------------------------------- */

    /* info banners */
    .banner {
        box-sizing: border-box;
        display: block;
        position: relative;
        width: 100%;
        margin-top: 20px;
        margin-bottom: 20px;
        padding: 20px;
        text-align: center;
    }

    /* paragraph in banner */
    .banner > p {
        margin: 0;
    }

    /* -------------------------------------------------- */
    /* highlight colors */
    /* -------------------------------------------------- */

    .white {
        background: #ffffff;
    }
    .lightgrey {
        background: #eeeeee;
    }
    .grey {
        background: #757575;
    }
    .darkgrey {
        background: #424242;
    }
    .black {
        background: #000000;
    }
    .lightred {
        background: #ffcdd2;
    }
    .lightyellow {
        background: #ffecb3;
    }
    .lightgreen {
        background: #dcedc8;
    }
    .lightblue {
        background: #e3f2fd;
    }
    .lightpurple {
        background: #f3e5f5;
    }
    .red {
        background: #f44336;
    }
    .orange {
        background: #ff9800;
    }
    .yellow {
        background: #ffeb3b;
    }
    .green {
        background: #4caf50;
    }
    .blue {
        background: #2196f3;
    }
    .purple {
        background: #9c27b0;
    }
    .white,
    .lightgrey,
    .lightred,
    .lightyellow,
    .lightgreen,
    .lightblue,
    .lightpurple,
    .orange,
    .yellow,
    .white a,
    .lightgrey a,
    .lightred a,
    .lightyellow a,
    .lightgreen a,
    .lightblue a,
    .lightpurple a,
    .orange a,
    .yellow a {
        color: #000000;
    }
    .grey,
    .darkgrey,
    .black,
    .red,
    .green,
    .blue,
    .purple,
    .grey a,
    .darkgrey a,
    .black a,
    .red a,
    .green a,
    .blue a,
    .purple a {
        color: #ffffff;
    }

    /* -------------------------------------------------- */
    /* buttons */
    /* -------------------------------------------------- */

    /* class for styling links like buttons */
    .button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        margin: 5px;
        padding: 10px 20px;
        font-size: 0.75em;
        font-weight: 600;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 1px;
        background: none;
        color: #2196f3;
        border: solid 1px #bdbdbd;
        border-radius: 5px;
    }

    /* buttons when hovered */
    .button:hover:not([disabled]),
    .icon_button:hover:not([disabled]) {
        cursor: pointer;
        background: #f5f5f5;
    }

    /* buttons when disabled */
    .button[disabled],
    .icon_button[disabled] {
        opacity: 0.35;
        pointer-events: none;
    }

    /* class for styling buttons containg only single icon */
    .icon_button {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        text-decoration: none;
        margin: 0;
        padding: 0;
        background: none;
        border-radius: 5px;
        border: none;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
    }

    /* icon button inner svg image */
    .icon_button > svg {
        height: 16px;
    }

    /* -------------------------------------------------- */
    /* icons */
    /* -------------------------------------------------- */

    /* class for styling icons inline with text */
    .inline_icon {
        height: 1em;
        position: relative;
        top: 0.125em;
    }

    /* -------------------------------------------------- */
    /* print control */
    /* -------------------------------------------------- */

    @media print {
        @page {
            /* suggested printing margin */
            margin: 0.5in;
        }

        /* document and "page" elements */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        /* "page" element */
        body {
            font-size: 11pt !important;
            line-height: 1.35;
        }

        /* all headings */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 15px 0;
        }

        /* heading 1 */
        h1 {
            font-size: 1.75em;
        }

        /* heading 2 */
        h2 {
            font-size: 1.25em;
            margin-top: 0;
        }

        /* heading 3 */
        h3 {
            font-size: 1.10em;
        }

        /* figures and tables */
        figure, table {
            /*font-size: 0.85em; - commented out by Serena */
            font-size: 0.60em;    /* added by Serena - set size relative to main document font-size */
            table-layout: fixed;  /* added by Serena */
            width: 8.5in;         /* added by Serena */
        }


        /* table cells */
        th,
        td {
            padding: 5px;
        }

        table td { /* added by Serena */
            word-wrap: break-word;         /* All browsers since IE 5.5+ */
            overflow-wrap: break-word;     /* Renamed property in CSS3 draft spec */
        }

        /* shrink font awesome icons */
        i.fas,
        i.fab,
        i.far,
        i.fal {
            transform: scale(0.85);
        }

        /* decrease banner margins */
        .banner {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 15px;
        }

        /* class for centering an element vertically on its own page */
        .page_center {
            margin: auto;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            vertical-align: middle;
            break-before: page;
            break-after: page;
        }

        /* always insert a page break before the element */
        .page_break_before {
            break-before: page;
        }

        /* always insert a page break after the element */
        .page_break_after {
            break-after: page;
        }

        /* avoid page break before the element */
        .page_break_before_avoid {
            break-before: avoid;
        }

        /* avoid page break after the element */
        .page_break_after_avoid {
            break-after: avoid;
        }

        /* avoid page break inside the element */
        .page_break_inside_avoid {
            break-inside: avoid;
        }
    }

    /* -------------------------------------------------- */
    /* override pandoc css quirks */
    /* -------------------------------------------------- */

    .sourceCode {
        /* prevent unsightly overflow in wide code blocks */
        overflow: auto !important;
    }

    div.sourceCode {
        /* prevent background fill on top-most code block  container */
        background: none !important;
    }

    .sourceCode * {
        /* force consistent line spacing */
        line-height: 1.5 !important;
    }

    div.sourceCode {
        /* style code block margins same as <pre> element */
        margin-top: 20px;
        margin-bottom: 20px;
    }

    /* -------------------------------------------------- */
    /* mathjax */
    /* -------------------------------------------------- */

    /* mathjax containers */
    .math.display > span:not(.MathJax_Preview) {
        /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
        display: flex !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        justify-content: center;
        align-items: center;
        margin: 0 !important;
    }

    /* right click menu */
    .MathJax_Menu {
        border-radius: 5px !important;
        border: solid 1px #bdbdbd !important;
        box-shadow: none !important;
    }

    /* equation auto-number */
    span[id^="eq:"] > span.math.display + span {
        font-weight: 600;
    }

    /* equation */
    span[id^="eq:"] > span.math.display > span {
        /* nudge to make room for equation auto-number */
        margin-right: 40px !important;
    }

    /* -------------------------------------------------- */
    /* table scroll plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* table wrapper */
        .table_wrapper {
            /* show scrollbar on tables if necessary to prevent overflow */
            overflow: auto;
            width: 100%;
            margin: 20px 0;
        }

        /* table within table wrapper */
        .table_wrapper table,
        .table_wrapper table * {
            /* don't break table words */
            word-break: normal !important;
        }

        .table_wrapper > table {
            /* move margins from table to table_wrapper to allow margin collapsing */
            margin: 0;
        }
    }

    /* -------------------------------------------------- */
    /* anchors plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anchor button */
        .anchor {
            opacity: 0;
            margin-left: 5px;
        }

        /* anchor buttons within <h2>'s */
        h2 .anchor {
            margin-left: 10px;
        }

        /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
        *:hover > .anchor,
        .anchor:hover,
        .anchor:focus {
            opacity: 1;
        }

        /* anchor button when hovered */
        .anchor:hover {
            cursor: pointer;
        }
    }

    /* always show anchor button on devices with no mouse/hover ability */
    @media (hover: none) {
        .anchor {
            opacity: 1;
        }
    }

    /* always hide anchor button on print */
    @media only print {
        .anchor {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* accordion plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* accordion arrow button */
        .accordion_arrow {
            margin-right: 10px;
        }

        /* arrow icon when <h2> data-collapsed attribute true */
        h2[data-collapsed="true"] > .accordion_arrow > svg {
            transform: rotate(-90deg);
        }

        /* all elements (except <h2>'s) when data-collapsed attribute true */
        *:not(h2)[data-collapsed="true"] {
            display: none;
        }

        /* accordion arrow button when hovered and <h2>'s when hovered */
        .accordion_arrow:hover,
        h2[data-collapsed="true"]:hover,
        h2[data-collapsed="false"]:hover {
            cursor: pointer;
        }
    }

    /* always hide accordion arrow button on print */
    @media only print {
        .accordion_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* tooltips plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* tooltip container */
        #tooltip {
            position: absolute;
            width: 50%;
            min-width: 240px;
            max-width: 75%;
            z-index: 1;
        }

        /* tooltip content */
        #tooltip_content {
            margin-bottom: 5px;
            padding: 20px;
            border-radius: 5px;
            border: solid 1px #bdbdbd;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            background: #ffffff;
            word-break: break-word;
        }

        /* tooltip copy of paragraphs and figures */
        #tooltip_content > p,
        #tooltip_content > figure {
            margin: 0;
            max-height: 320px;
            overflow-y: auto;
        }

        /* tooltip copy of <img> */
        #tooltip_content > figure > img {
            max-height: 260px;
        }

        /* navigation bar */
        #tooltip_nav_bar {
            margin-top: 10px;
            text-align: center;
        }

        /* navigation bar previous/next buton */
        #tooltip_nav_bar > .icon_button {
            position: relative;
            top: 3px;
        }

        /* navigation bar previous button */
        #tooltip_nav_bar > .icon_button:first-of-type {
            margin-right: 5px;
        }

        /* navigation bar next button */
        #tooltip_nav_bar > .icon_button:last-of-type {
            margin-left: 5px;
        }
    }

    /* always hide tooltip on print */
    @media only print {
        #tooltip {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* jump to first plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* jump button */
        .jump_arrow {
            position: relative;
            top: 0.125em;
            margin-right: 5px;
        }
    }

    /* always hide jump button on print */
    @media only print {
        .jump_arrow {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* link highlight plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* anything with data-highlighted attribute true */
        [data-highlighted="true"] {
            background: #ffeb3b;
        }

        /* anything with data-selected attribute true */
        [data-selected="true"] {
            background: #ff8a65 !important;
        }

        /* animation definition for glow */
        @keyframes highlight_glow {
            0% {
                background: none;
            }
            10% {
                background: #bbdefb;
            }
            100% {
                background: none;
            }
        }

        /* anything with data-glow attribute true */
        [data-glow="true"] {
            animation: highlight_glow 2s;
        }
    }

    /* -------------------------------------------------- */
    /* table of contents plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* toc panel */
        #toc_panel {
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            background: #ffffff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 2;
        }

        /* toc panel when closed */
        #toc_panel[data-open="false"] {
            min-width: 60px;
            width: 60px;
            height: 60px;
            border-right: solid 1px #bdbdbd;
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc panel when open */
        #toc_panel[data-open="true"] {
            min-width: 260px;
            max-width: 480px;
            /* keep panel edge consistent distance away from "page" edge */
            width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
            bottom: 0;
            border-right: solid 1px #bdbdbd;
        }

        /* toc panel header */
        #toc_header {
            box-sizing: border-box;
            display: flex;
            flex-direction: row;
            align-items: center;
            height: 60px;
            margin: 0;
            padding: 20px;
        }

        /* toc panel header when hovered */
        #toc_header:hover {
            cursor: pointer;
        }

        /* toc panel header when panel open */
        #toc_panel[data-open="true"] > #toc_header {
            border-bottom: solid 1px #bdbdbd;
        }

        /* toc open/close header button */
        #toc_button {
            margin-right: 20px;
        }

        /* hide toc list and header text when closed */
        #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
        #toc_panel[data-open="false"] > #toc_list {
            display: none;
        }

        /* toc list of entries */
        #toc_list {
            box-sizing: border-box;
            width: 100%;
            padding: 20px;
            position: absolute;
            top: calc(60px + 1px);
            bottom: 0;
            overflow: auto;
        }

        /* toc entry, link to section in document */
        .toc_link {
            display: block;
            padding: 5px;
            position: relative;
            font-weight: 600;
            text-decoration: none;
        }

        /* toc entry when hovered or when "viewed" */
        .toc_link:hover,
        .toc_link[data-viewing="true"] {
            background: #f5f5f5;
        }

        /* toc entry, level 1 indentation */
        .toc_link[data-level="1"] {
            margin-left: 0;
        }

        /* toc entry, level 2 indentation */
        .toc_link[data-level="2"] {
            margin-left: 20px;
        }

        /* toc entry, level 3 indentation */
        .toc_link[data-level="3"] {
            margin-left: 40px;
        }

        /* toc entry, level 4 indentation */
        .toc_link[data-level="4"] {
            margin-left: 60px;
        }

        /* toc entry bullets */
        #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
            position: absolute;
            left: -15px;
            top: -1px;
            font-size: 1.5em;
        }

        /* toc entry, level 2 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
            content: "\2022";
        }

        /* toc entry, level 3 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
            content: "\25AB";
        }

        /* toc entry, level 4 bullet */
        #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
            content: "-";
        }
    }

    /* when on screen < 8.5in wide */
    @media only screen and (max-width: 8.5in) {
        /* push <body> ("page") element down to make room for toc icon */
        .toc_body_nudge {
            padding-top: 60px;
        }

        /* toc icon when panel closed and not hovered */
        #toc_panel[data-open="false"]:not(:hover) {
            background: rgba(255, 255, 255, 0.75);
        }
    }

    /* always hide toc panel on print */
    @media only print {
        #toc_panel {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* lightbox plugin */
    /* -------------------------------------------------- */

    @media only screen {
        /* regular <img> in document when hovered */
        .lightbox_document_img:hover {
            cursor: pointer;
        }

        .body_no_scroll {
            overflow: hidden !important;
        }

        /* screen overlay */
        #lightbox_overlay {
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 3;
        }

        /* middle area containing lightbox image */
        #lightbox_image_container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            padding: 20px;
        }

        /* bottom area containing caption */
        #lightbox_bottom_container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            min-height: 100px;
            max-height: 100px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* image number info text box */
        #lightbox_number_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            left: 2px;
            top: 0;
            z-index: 4;
        }

        /* zoom info text box */
        #lightbox_zoom_info {
            position: absolute;
            color: #ffffff;
            font-weight: 600;
            right: 2px;
            top: 0;
            z-index: 4;
        }

        /* copy of image caption */
        #lightbox_caption {
            box-sizing: border-box;
            display: inline-block;
            width: 100%;
            max-height: 100%;
            padding: 10px 0;
            text-align: center;
            overflow-y: auto;
            color: #ffffff;
        }

        /* navigation previous/next button */
        .lightbox_button {
            width: 100px;
            height: 100%;
            min-width: 100px;
            min-height: 100%;
            color: #ffffff;
        }

        /* navigation previous/next button when hovered */
        .lightbox_button:hover {
            background: none !important;
        }

        /* navigation button icon */
        .lightbox_button > svg {
            height: 25px;
        }

        /* figure auto-number */
        #lightbox_caption > span:first-of-type {
            font-weight: bold;
            margin-right: 5px;
        }

        /* lightbox image when hovered */
        #lightbox_img:hover {
            cursor: grab;
        }

        /* lightbox image when grabbed */
        #lightbox_img:active {
            cursor: grabbing;
        }
    }

    /* when on screen < 480px wide */
    @media only screen and (max-width: 480px) {
        /* make navigation buttons skinnier on small screens to make more room for caption text */
        .lightbox_button {
            width: 50px;
            min-width: 50px;
        }
    }

    /* always hide lightbox on print */
    @media only print {
        #lightbox_overlay {
            display: none;
        }
    }

    /* -------------------------------------------------- */
    /* hypothesis (annotations) plugin */
    /* -------------------------------------------------- */

    /* side panel */
    .annotator-frame {
        width: 280px !important;
        z-index: 0 !important;
    }

    /* match highlight color to rest of theme */
    .annotator-highlights-always-on .annotator-hl {
        background-color: #ffeb3b !important;
    }

    /* match focused color to rest of theme */
    .annotator-hl.annotator-hl-focused {
        background-color: #ff8a65 !important;
    }

    /* match bucket bar color to rest of theme */
    .annotator-bucket-bar {
        background: #f5f5f5 !important;
    }

    /* always hide toolbar and tooltip on print */
    @media only print {
        .annotator-frame {
            display: none !important;
        }

        hypothesis-adder {
            display: none !important;
        }
    }
</style>
<!-- table scroll plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows tables that are too wide to fit within
        // the page to have a scrollbar instead of being squashed to fit.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tableScroll';

        // default plugin options
        const options = {
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // wrap each table in a container
            const tables = document.querySelectorAll('table');
            for (const table of tables)
                wrapElement(table).classList.add('table_wrapper');
            // table_wrapper CSS class in theme file provides scroll
            // functionality
        }

        // wrap element in div and return div
        function wrapElement(element) {
            const parent = element.parentNode;
            const wrapper = document.createElement('div');
            parent.replaceChild(wrapper, element);
            wrapper.appendChild(element);
            return wrapper;
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- anchors plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds an anchor next to each of a certain type
        // of element that provides a human-readable url to that specific
        // item/position in the document (eg "manuscript.html#abstract"). It
        // also makes it such that scrolling out of view of a target removes
        // its identifier from the url.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'anchors';

        // default plugin options
        const options = {
            // which types of elements to add anchors next to, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3, figure, table',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // add anchor to each element of specified types
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements)
                addAnchor(element);

            // attach scroll listener to window
            window.addEventListener('scroll', onScroll);
        }

        // when window is scrolled
        function onScroll() {
            // if url has hash and user has scrolled out of view of hash
            // target, remove hash from url
            const target = getHashTarget();
            if (target) {
                if (
                    target.getBoundingClientRect().top > window.innerHeight ||
                    target.getBoundingClientRect().bottom < 0
                )
                    history.pushState(null, null, ' ');
            }
        }

        // add anchor to element
        function addAnchor(element) {
            let withId; // element with unique id
            let addTo; // element to add anchor button to

            // if figure or table, modify withId and addTo to get expected
            // elements
            if (element.tagName.toLowerCase() === 'figure') {
                withId = element.querySelector('img');
                addTo = element.querySelector('figcaption');
            } else if (element.tagName.toLowerCase() === 'table') {
                withId =
                    element.previousElementSibling ||
                    element.parentNode.previousElementSibling;
                addTo = element.querySelector('caption');
            }

            withId = withId || element;
            addTo = addTo || element;
            const id = withId.id || withId.name || null;

            // do not add anchor if element doesn't have assigned id.
            // id is generated by pandoc and is assumed to be unique and
            // human-readable
            if (!id)
                return;

            // create anchor button
            const anchor = document.createElement('a');
            anchor.innerHTML = document.querySelector('.icon_link').innerHTML;
            anchor.title = 'Link to this part of the document';
            anchor.classList.add('icon_button', 'anchor');
            anchor.dataset.ignore = 'true';
            anchor.href = '#' + id;
            addTo.appendChild(anchor);
        }

        // get element that is target of link or url hash
        function getHashTarget() {
            const hash = window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector(
                '[id="' + id + '"], [name="' + id + '"]'
            );
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (hash.indexOf('#fig:') === 0)
                target = target.parentNode;
            if (hash.indexOf('#tbl:') === 0)
                target = target.nextElementSibling;

            return target;
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- link icon -->

<template class="icon_link">
    <!-- modified from: https://fontawesome.com/icons/link -->
    <svg width="16" height="16" viewBox="0 0 512 512">
        <path
            fill="currentColor"
            d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
        ></path>
    </svg>
</template>
<!-- accordion plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin allows sections of content under <h2> headings
        // to be collapsible.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'accordion';

        // default plugin options
        const options = {
            // whether to always start expanded ('false'), always start
            // collapsed ('true'), or start collapsed when screen small ('auto')
            startCollapsed: 'auto',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <h2> heading
            const headings = document.querySelectorAll('h2');
            for (const heading of headings) {
                addArrow(heading);

                // start expanded/collapsed based on option
                if (
                    options.startCollapsed === 'true' ||
                    (options.startCollapsed === 'auto' && isSmallScreen())
                )
                    collapseHeading(heading);
                else
                    expandHeading(heading);
            }

            // attach hash change listener to window
            window.addEventListener('hashchange', onHashChange);
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                goToElement(target);
        }

        // add arrow to heading
        function addArrow(heading) {
            // add arrow button
            const arrow = document.createElement('button');
            arrow.innerHTML = document.querySelector(
                '.icon_angle_down'
            ).innerHTML;
            arrow.classList.add('icon_button', 'accordion_arrow');
            heading.insertBefore(arrow, heading.firstChild);

            // attach click listener to heading and button
            heading.addEventListener('click', onHeadingClick);
            arrow.addEventListener('click', onArrowClick);
        }

        // determine if on mobile-like device with small screen
        function isSmallScreen() {
            return Math.min(window.innerWidth, window.innerHeight) < 480;
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get element that is target of hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector(
                '[id="' + id + '"], [name="' + id + '"]'
            );
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (hash.indexOf('#fig:') === 0)
                target = target.parentNode;
            if (hash.indexOf('#tbl:') === 0)
                target = target.nextElementSibling;

            return target;
        }

        // when <h2> heading is clicked
        function onHeadingClick(event) {
            // only collapse if <h2> itself is target of click (eg, user did
            // not click on anchor within <h2>)
            if (event.target === this)
                toggleCollapse(this);
        }

        // when arrow button is clicked
        function onArrowClick() {
            toggleCollapse(this.parentNode);
        }

        // collapse section if expanded, expand if collapsed
        function toggleCollapse(heading) {
            if (heading.dataset.collapsed === 'false')
                collapseHeading(heading);
            else
                expandHeading(heading);
        }

        // elements to exclude from collapse, such as table of contents panel,
        // hypothesis panel, etc
        const exclude = '#toc_panel, div.annotator-frame, #lightbox_overlay';

        // collapse section
        function collapseHeading(heading) {
            heading.setAttribute('data-collapsed', 'true');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'true');
        }

        // expand section
        function expandHeading(heading) {
            heading.setAttribute('data-collapsed', 'false');
            const children = getChildren(heading);
            for (const child of children)
                child.setAttribute('data-collapsed', 'false');
        }

        // get list of elements between this <h2> and next <h2> or <h1>
        // ("children" of the <h2> section)
        function getChildren(heading) {
            return nextUntil(heading, 'h2, h1', exclude);
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get list of elements after a start element up to element matching
        // query
        function nextUntil(element, query, exclude) {
            const elements = [];
            while (element = element.nextElementSibling, element) {
                if (element.matches(query))
                    break;
                if (!element.matches(exclude))
                    elements.push(element);
            }
            return elements;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
    <!-- modified from: https://fontawesome.com/icons/angle-down -->
    <svg width="16" height="16" viewBox="0 0 448 512">
        <path
            fill="currentColor"
            d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
        ></path>
    </svg>
</template>
<!-- tooltips plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when the user hovers or
        // focuses a link to a citation or figure, a tooltip appears with a
        // preview of the reference content, along with arrows to navigate
        // between instances of the same reference in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tooltips';

        // default plugin options
        const options = {
            // whether user must click off to close tooltip instead of just
            // un-hovering
            clickClose: 'false',
            // delay (in ms) between opening and closing tooltip
            delay: '100',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach hover and focus listeners to link
                link.addEventListener('mouseover', onLinkHover);
                link.addEventListener('mouseleave', onLinkUnhover);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('touchend', onLinkTouch);
            }

            // attach mouse, key, and resize listeners to window
            window.addEventListener('mousedown', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('keyup', onKeyUp);
            window.addEventListener('resize', onResize);
        }

        // when link is hovered
        function onLinkHover() {
            // function to open tooltip
            const delayOpenTooltip = function() {
                openTooltip(this);
            }.bind(this);

            // run open function after delay
            this.openTooltipTimer = window.setTimeout(
                delayOpenTooltip,
                options.delay
            );
        }

        // when mouse leaves link
        function onLinkUnhover() {
            // cancel opening tooltip
            window.clearTimeout(this.openTooltipTimer);

            // don't close on unhover if option specifies
            if (options.clickClose === 'true')
                return;

            // function to close tooltip
            const delayCloseTooltip = function() {
                // if tooltip open and if mouse isn't over tooltip, close
                const tooltip = document.getElementById('tooltip');
                if (tooltip && !tooltip.matches(':hover'))
                    closeTooltip();
            };

            // run close function after delay
            this.closeTooltipTimer = window.setTimeout(
                delayCloseTooltip,
                options.delay
            );
        }

        // when link is focused (tabbed to)
        function onLinkFocus(event) {
            openTooltip(this);
        }

        // when link is touched on touch screen
        function onLinkTouch(event) {
            // attempt to force hover state on first tap always, and trigger
            // regular link click (and navigation) on second tap
            if (event.target === document.activeElement)
                event.target.click();
            else {
                document.activeElement.blur();
                event.target.focus();
            }
            if (event.cancelable)
                event.preventDefault();
            event.stopPropagation();
            return false;
        }

        // when mouse is clicked anywhere in window
        function onClick(event) {
            closeTooltip();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'tooltip_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'tooltip_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeTooltip();
                    break;
            }
        }

        // when window is resized or zoomed
        function onResize() {
            closeTooltip();
        }

        // get all links of types we wish to handle
        function getLinks() {
            const queries = [];
            // exclude buttons, anchor links, toc links, etc
            const exclude =
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            queries.push('a[href^="#ref-"]' + exclude); // citation links
            queries.push('a[href^="#fig:"]' + exclude); // figure links
            const query = queries.join(', ');
            return document.querySelectorAll(query);
        }

        // get links with same target, get index of link in set, get total
        // same links
        function getSameLinks(link) {
            const sameLinks = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    sameLinks.push(otherLink);
            }

            return {
                elements: sameLinks,
                index: sameLinks.indexOf(link),
                total: sameLinks.length
            };
        }

        // open tooltip
        function openTooltip(link) {
            // delete tooltip if it exists, start fresh
            closeTooltip();

            // make tooltip element
            const tooltip = makeTooltip(link);

            // if source couldn't be found and tooltip not made, exit
            if (!tooltip)
                return;

            // make navbar elements
            const navBar = makeNavBar(link);
            if (navBar)
                tooltip.firstElementChild.appendChild(navBar);

            // attach tooltip to page
            document.body.appendChild(tooltip);

            // position tooltip
            const position = function() {
                positionTooltip(link);
            };
            position();

            // if tooltip contains images, position again after they've loaded
            const imgs = tooltip.querySelectorAll('img');
            for (const img of imgs)
                img.addEventListener('load', position);
        }

        // close (delete) tooltip
        function closeTooltip() {
            const tooltip = document.getElementById('tooltip');
            if (tooltip)
                tooltip.remove();
        }

        // make tooltip
        function makeTooltip(link) {
            // get target element that link points to
            const source = getSource(link);

            // if source can't be found, exit
            if (!source)
                return;

            // create new tooltip
            const tooltip = document.createElement('div');
            tooltip.id = 'tooltip';
            const tooltipContent = document.createElement('div');
            tooltipContent.id = 'tooltip_content';
            tooltip.appendChild(tooltipContent);

            // make copy of source node and put in tooltip
            const sourceCopy = makeCopy(source);
            tooltipContent.appendChild(sourceCopy);

            // attach mouse event listeners
            tooltip.addEventListener('click', onTooltipClick);
            tooltip.addEventListener('mousedown', onTooltipClick);
            tooltip.addEventListener('touchstart', onTooltipClick);
            tooltip.addEventListener('mouseleave', onTooltipUnhover);

            // (for interaction with lightbox plugin)
            // transfer click on tooltip copied img to original img
            const sourceImg = source.querySelector('img');
            const sourceCopyImg = sourceCopy.querySelector('img');
            if (sourceImg && sourceCopyImg) {
                const clickImg = function() {
                    sourceImg.click();
                    closeTooltip();
                };
                sourceCopyImg.addEventListener('click', clickImg);
            }

            return tooltip;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // when tooltip is clicked
        function onTooltipClick(event) {
            // when user clicks on tooltip, stop click from transferring
            // outside of tooltip (eg, click off to close tooltip, or eg click
            // off to unhighlight same refs)
            event.stopPropagation();
        }

        // when tooltip is unhovered
        function onTooltipUnhover(event) {
            if (options.clickClose === 'true')
                return;

            // make sure new mouse/touch/focus no longer over tooltip or any
            // element within it
            const tooltip = document.getElementById('tooltip');
            if (!tooltip)
                return;
            if (this.contains(event.relatedTarget))
                return;

            closeTooltip();
        }

        // make nav bar to go betwen prev/next instances of same reference
        function makeNavBar(link) {
            // find other links to the same source
            const sameLinks = getSameLinks(link);

            // don't show nav bar when singular reference
            if (sameLinks.total <= 1)
                return;

            // find prev/next links with same target
            const prevLink = getPrevLink(link, sameLinks);
            const nextLink = getNextLink(link, sameLinks);

            // create nav bar
            const navBar = document.createElement('div');
            navBar.id = 'tooltip_nav_bar';
            const text = sameLinks.index + 1 + ' of ' + sameLinks.total;

            // create nav bar prev/next buttons
            const prevButton = document.createElement('button');
            const nextButton = document.createElement('button');
            prevButton.id = 'tooltip_prev_button';
            nextButton.id = 'tooltip_next_button';
            prevButton.title =
                'Jump to the previous occurence of this item in the document [←]';
            nextButton.title =
                'Jump to the next occurence of this item in the document [→]';
            prevButton.classList.add('icon_button');
            nextButton.classList.add('icon_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;
            navBar.appendChild(prevButton);
            navBar.appendChild(document.createTextNode(text));
            navBar.appendChild(nextButton);

            // attach click listeners to buttons
            prevButton.addEventListener('click', function() {
                onPrevNextClick(link, prevLink);
            });
            nextButton.addEventListener('click', function() {
                onPrevNextClick(link, nextLink);
            });

            return navBar;
        }

        // get previous link with same target
        function getPrevLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if < 1
            let index;
            if (sameLinks.index - 1 >= 0)
                index = sameLinks.index - 1;
            else
                index = sameLinks.total - 1;
            return sameLinks.elements[index];
        }

        // get next link with same target
        function getNextLink(link, sameLinks) {
            if (!sameLinks)
                sameLinks = getSameLinks(link);
            // wrap index to other side if > total
            let index;
            if (sameLinks.index + 1 <= sameLinks.total - 1)
                index = sameLinks.index + 1;
            else
                index = 0;
            return sameLinks.elements[index];
        }

        // get element that is target of link or url hash
        function getSource(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector(
                '[id="' + id + '"], [name="' + id + '"]'
            );
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (hash.indexOf('#ref-') === 0)
                target = target.querySelector('p');
            else if (hash.indexOf('#fig:') === 0)
                target = target.parentNode;
            else if (hash.indexOf('#tbl:') === 0)
                return;

            return target;
        }

        // when prev/next arrow button is clicked
        function onPrevNextClick(link, prevNextLink) {
            if (link && prevNextLink)
                goToElement(prevNextLink, window.innerHeight * 0.5);
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // determine position to place tooltip based on link position in
        // viewport and tooltip size
        function positionTooltip(link, left, top) {
            const tooltipElement = document.getElementById('tooltip');
            if (!tooltipElement)
                return;

            // get convenient vars for position/dimensions of
            // link/tooltip/page/view
            link = getRectInPage(link);
            const tooltip = getRectInPage(tooltipElement);
            const view = getRectInPage();

            // horizontal positioning
            if (left)
                // use explicit value
                left = left;
            else if (link.left + tooltip.width < view.right)
                // fit tooltip to right of link
                left = link.left;
            else if (link.right - tooltip.width > view.left)
                // fit tooltip to left of link
                left = link.right - tooltip.width;
            // center tooltip in view
            else
                left = (view.right - view.left) / 2 - tooltip.width / 2;

            // vertical positioning
            if (top)
                // use explicit value
                top = top;
            else if (link.top - tooltip.height > view.top)
                // fit tooltip above link
                top = link.top - tooltip.height;
            else if (link.bottom + tooltip.height < view.bottom)
                // fit tooltip below link
                top = link.bottom;
            else {
                // center tooltip in view
                top = view.top + view.height / 2 - tooltip.height / 2;
                // nudge off of link to left/right if possible
                if (link.right + tooltip.width < view.right)
                    left = link.right;
                else if (link.left - tooltip.width > view.left)
                    left = link.left - tooltip.width;
            }

            tooltipElement.style.left = left + 'px';
            tooltipElement.style.top = top + 'px';
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get position of element relative to page
        function getRectInPage(element) {
            const rect = getRectInView(element);
            const body = getRectInView(document.body);

            const newRect = {};
            newRect.left = rect.left - body.left;
            newRect.top = rect.top - body.top;
            newRect.right = rect.right - body.left;
            newRect.bottom = rect.bottom - body.top;
            newRect.width = rect.width;
            newRect.height = rect.height;

            return newRect;
        }

        // (for interaction with accordion plugin)
        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // (for interaction with accordion plugin)
        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- jump to first plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin adds a button next to each reference entry,
        // figure, and table that jumps the page to the first occurrence of a
        // link to that item in the manuscript.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'jumpToFirst';

        // default plugin options
        const options = {
            // whether to add buttons next to reference entries
            references: 'true',
            // whether to add buttons next to figures
            figures: 'true',
            // whether to add buttons next to tables
            tables: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            if (options.references !== 'false')
                makeReferenceButtons();
            if (options.figures !== 'false')
                makeFigureButtons();
            if (options.tables !== 'false')
                makeTableButtons();
        }

        // when jump button clicked
        function onButtonClick() {
            const first = getFirstOccurrence(this.dataset.id);
            if (!first)
                return;

            // update url hash so navigating "back" in history will return
            // user to jump button
            window.location.hash = this.dataset.id;
            // scroll to link
            window.setTimeout(function() {
                goToElement(first, window.innerHeight * 0.5);
            }, 0);
        }

        // get first occurence of link to item in document
        function getFirstOccurrence(id) {
            let query = 'a';
            query += '[href="#' + id + '"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelector(query);
        }

        // add button next to each reference entry
        function makeReferenceButtons() {
            const references = document.querySelectorAll('div[id^="ref-"]');
            for (const reference of references) {
                // get reference id and element to add button to
                const id = reference.id;
                const container = reference.firstElementChild;
                const first = getFirstOccurrence(id);

                // if can't find link to reference, ignore
                if (!first)
                    continue;

                // make jump button
                let button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this reference in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.innerHTML = button.outerHTML + container.innerHTML;
                button = container.firstElementChild;
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeFigureButtons() {
            const figures = document.querySelectorAll('img[id^="fig:"]');
            for (const figure of figures) {
                // get figure id and element to add button to
                const id = figure.id;
                const container = figure.nextElementSibling;
                const first = getFirstOccurrence(id);

                // if can't find link to figure, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this figure in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // add button next to each figure
        function makeTableButtons() {
            const tables = document.querySelectorAll('a[name^="tbl:"]');
            for (const table of tables) {
                // get ref id and element to add button to
                const id = table.name;
                const container = table.nextElementSibling.querySelector(
                    'caption'
                );
                const first = getFirstOccurrence(id);

                // if can't find link to table, ignore
                if (!first)
                    continue;

                // make jump button
                const button = document.createElement('button');
                button.classList.add('icon_button', 'jump_arrow');
                button.title =
                    'Jump to the first occurence of this table in the document';
                button.innerHTML = document.querySelector(
                    '.icon_angle_double_up'
                ).innerHTML;
                button.dataset.id = id;
                button.dataset.ignore = 'true';
                container.insertBefore(button, container.firstElementChild);
                button.addEventListener('click', onButtonClick);
            }
        }

        // scroll to and focus element
        function goToElement(element, offset) {
            // expand accordion section if collapsed
            expandElement(element);
            const y =
                getRectInView(element).top -
                getRectInView(document.documentElement).top -
                (offset || 0);
            // trigger any function listening for "onscroll" event
            window.dispatchEvent(new Event('scroll'));
            window.scrollTo(0, y);
            document.activeElement.blur();
            element.focus();
        }

        // get position/dimensions of element or viewport
        function getRectInView(element) {
            let rect = {};
            rect.left = 0;
            rect.top = 0;
            rect.right = document.documentElement.clientWidth;
            rect.bottom = document.documentElement.clientHeight;
            let style = {};

            if (element instanceof HTMLElement) {
                rect = element.getBoundingClientRect();
                style = window.getComputedStyle(element);
            }

            const margin = {};
            margin.left = parseFloat(style.marginLeftWidth) || 0;
            margin.top = parseFloat(style.marginTopWidth) || 0;
            margin.right = parseFloat(style.marginRightWidth) || 0;
            margin.bottom = parseFloat(style.marginBottomWidth) || 0;

            const border = {};
            border.left = parseFloat(style.borderLeftWidth) || 0;
            border.top = parseFloat(style.borderTopWidth) || 0;
            border.right = parseFloat(style.borderRightWidth) || 0;
            border.bottom = parseFloat(style.borderBottomWidth) || 0;

            const newRect = {};
            newRect.left = rect.left + margin.left + border.left;
            newRect.top = rect.top + margin.top + border.top;
            newRect.right = rect.right + margin.right + border.right;
            newRect.bottom = rect.bottom + margin.bottom + border.bottom;
            newRect.width = newRect.right - newRect.left;
            newRect.height = newRect.bottom - newRect.top;

            return newRect;
        }

        // get closest element before specified element that matches query
        function firstBefore(element, query) {
            while (
                element &&
                element !== document.body &&
                !element.matches(query)
            )
                element = element.previousElementSibling || element.parentNode;

            return element;
        }

        // check if element is part of collapsed heading
        function isCollapsed(element) {
            while (element && element !== document.body) {
                if (element.dataset.collapsed === 'true')
                    return true;
                element = element.parentNode;
            }
            return false;
        }

        // (for interaction with accordion plugin)
        // expand heading containing element if necesary
        function expandElement(element) {
            if (isCollapsed(element)) {
                const heading = firstBefore(element, 'h2');
                if (heading)
                    heading.click();
            }
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
    <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
    <svg width="16" height="16" viewBox="0 0 320 512">
        <path
            fill="currentColor"
            d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
        ></path>
    </svg>
</template>
<!-- link highlight plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user hovers or
        // focuses a link, other links that have the same target will be
        // highlighted. It also makes it such that when clicking a link, the
        // target of the link (eg reference, figure, table) is briefly
        // highlighted.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'linkHighlight';

        // default plugin options
        const options = {
            // whether to also highlight links that go to external urls
            externalLinks: 'false',
            // whether user must click off to unhighlight instead of just
            // un-hovering
            clickUnhighlight: 'false',
            // whether to also highlight links that are unique
            highlightUnique: 'true',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            const links = getLinks();
            for (const link of links) {
                // attach mouse and focus listeners to link
                link.addEventListener('mouseenter', onLinkFocus);
                link.addEventListener('focus', onLinkFocus);
                link.addEventListener('mouseleave', onLinkUnhover);
            }

            // attach click and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('hashchange', onHashChange);

            // run hash change on window load in case user has navigated
            // directly to hash
            onHashChange();
        }

        // when link is focused (tabbed to) or hovered
        function onLinkFocus() {
            highlight(this);
        }

        // when link is unhovered
        function onLinkUnhover() {
            if (options.clickUnhighlight !== 'true')
                unhighlightAll();
        }

        // when the mouse is clicked anywhere in window
        function onClick(event) {
            unhighlightAll();
        }

        // when hash (eg manuscript.html#introduction) changes
        function onHashChange() {
            const target = getHashTarget();
            if (target)
                glowElement(target);
        }

        // get element that is target of link or url hash
        function getHashTarget(link) {
            const hash = link ? link.hash : window.location.hash;
            const id = hash.slice(1);
            let target = document.querySelector(
                '[id="' + id + '"], [name="' + id + '"]'
            );
            if (!target)
                return;

            // if figure or table, modify target to get expected element
            if (hash.indexOf('#fig:') === 0)
                target = target.parentNode;
            else if (hash.indexOf('#tbl:') === 0)
                target = target.nextElementSibling.querySelector('caption');

            return target;
        }

        // start glow sequence on an element
        function glowElement(element) {
            const startGlow = function() {
                onGlowEnd();
                element.dataset.glow = 'true';
                element.addEventListener('animationend', onGlowEnd);
            };
            const onGlowEnd = function() {
                element.removeAttribute('data-glow');
                element.removeEventListener('animationend', onGlowEnd);
            };
            startGlow();
        }

        // highlight link and all others with same target
        function highlight(link) {
            // force unhighlight all to start fresh
            unhighlightAll();

            // get links with same target
            if (!link)
                return;
            const sameLinks = getSameLinks(link);

            // if link unique and option is off, exit and don't highlight
            if (sameLinks.length <= 1 && options.highlightUnique !== 'true')
                return;

            // highlight all same links, and "select" (special highlight) this
            // one
            for (const sameLink of sameLinks) {
                if (sameLink === link)
                    sameLink.setAttribute('data-selected', 'true');
                else
                    sameLink.setAttribute('data-highlighted', 'true');
            }
        }

        // unhighlight all links
        function unhighlightAll() {
            const links = getLinks();
            for (const link of links) {
                link.setAttribute('data-selected', 'false');
                link.setAttribute('data-highlighted', 'false');
            }
        }

        // get links with same target
        function getSameLinks(link) {
            const results = [];
            const links = getLinks();
            for (const otherLink of links) {
                if (
                    otherLink.getAttribute('href') === link.getAttribute('href')
                )
                    results.push(otherLink);
            }
            return results;
        }

        // get all links of types we wish to handle
        function getLinks() {
            let query = 'a';
            if (options.externalLinks !== 'true')
                query += '[href^="#"]';
            // exclude buttons, anchor links, toc links, etc
            query +=
                ':not(.button):not(.icon_button):not(.anchor):not(.toc_link)';
            return document.querySelectorAll(query);
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>
<!-- table of contents plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin provides a "table of contents" (toc) panel on
        // the side of the document that allows the user to conveniently
        // navigate between sections of the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'tableOfContents';

        // default plugin options
        const options = {
            // which types of elements to add links for, in
            // "document.querySelector" format
            typesQuery: 'h1, h2, h3',
            // whether default behavior is to be closed ('false'), open
            // ('true'), or only open when screen wide enough to fit panel
            // ('auto'). note: still always starts closed when page loads.
            open: 'auto',
            // if list item is more than this many characters, text will be
            // truncated
            charLimit: '50',
            // whether or not to show bullets next to each toc item
            bullets: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // make toc panel and populate with entries (links to document
            // sections)
            const panel = makePanel();
            if (!panel)
                return;
            makeEntries(panel);
            document.body.insertBefore(panel, document.body.firstChild);

            closePanel();

            // attach click, scroll, and hash change listeners to window
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onClick);
            window.addEventListener('scroll', onScroll);
            window.addEventListener('hashchange', onScroll);
            window.addEventListener('keyup', onKeyUp);
            onScroll();

            // add class to push document body down out of way of toc button
            document.body.classList.add('toc_body_nudge');
        }

        // determine if screen wide enough to fit toc panel
        function isSmallScreen() {
            // in default theme:
            // 816px = 8.5in = width of "page" (<body>) element
            // 260px = min width of toc panel (*2 for both sides of <body>)
            return window.innerWidth < 816 + 260 * 2;
        }

        // open/close panel based on option and screen size
        function openOrClosePanel() {
            if (
                options.open === 'true' ||
                (options.open === 'auto' && !isSmallScreen())
            )
                openPanel();
            else
                closePanel();
        }

        // when mouse is clicked anywhere in window
        function onClick() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                openOrClosePanel();
        }

        // when window is scrolled or hash changed
        function onScroll() {
            highlightViewed();
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            // close on esc
            if (event.key === 'Escape')
                closePanel();
        }

        // find entry of currently viewed document section in toc and highlight
        function highlightViewed() {
            const firstId = getFirstInView(options.typesQuery);

            // get toc entries (links), unhighlight all, then highlight viewed
            const list = document.getElementById('toc_list');
            if (!firstId || !list)
                return;
            const links = list.querySelectorAll('a');
            for (const link of links)
                link.dataset.viewing = 'false';
            const link = list.querySelector('a[href="#' + firstId + '"]');
            if (!link)
                return;
            link.dataset.viewing = 'true';
        }

        // get first or previous toc listed element in top half of view
        function getFirstInView(query) {
            // get all elements matching query and with id
            const elements = document.querySelectorAll(query);
            const elementsWithIds = [];
            for (const element of elements) {
                if (element.id)
                    elementsWithIds.push(element);
            }


            // get first or previous element in top half of view
            for (let i = 0; i < elementsWithIds.length; i++) {
                const element = elementsWithIds[i];
                const prevElement = elementsWithIds[Math.max(0, i - 1)];
                if (element.getBoundingClientRect().top >= 0) {
                    if (
                        element.getBoundingClientRect().top <
                        window.innerHeight / 2
                    )
                        return element.id;
                    else
                        return prevElement.id;
                }
            }
        }

        // make panel
        function makePanel() {
            // create panel
            const panel = document.createElement('div');
            panel.id = 'toc_panel';
            if (options.bullets === 'true')
                panel.dataset.bullets = 'true';

            // create header
            const header = document.createElement('div');
            header.id = 'toc_header';

            // create toc button
            const button = document.createElement('button');
            button.id = 'toc_button';
            button.innerHTML = document.querySelector(
                '.icon_th_list'
            ).innerHTML;
            button.classList.add('icon_button');

            // create header text
            const text = document.createElement('h3');
            text.innerHTML = 'Table of Contents';

            // create container for toc list
            const list = document.createElement('div');
            list.id = 'toc_list';

            // attach click listeners
            panel.addEventListener('click', onPanelClick);
            header.addEventListener('click', onHeaderClick);
            button.addEventListener('click', onButtonClick);

            // attach elements
            header.appendChild(button);
            header.appendChild(text);
            panel.appendChild(header);
            panel.appendChild(list);

            return panel;
        }

        // create toc entries (links) to each element of the specified types
        function makeEntries(panel) {
            const elements = document.querySelectorAll(options.typesQuery);
            for (const element of elements) {
                // do not add link if element doesn't have assigned id
                if (!element.id)
                    continue;

                // create link/list item
                const link = document.createElement('a');
                link.classList.add('toc_link');
                switch (element.tagName.toLowerCase()) {
                    case 'h1':
                        link.dataset.level = '1';
                        break;
                    case 'h2':
                        link.dataset.level = '2';
                        break;
                    case 'h3':
                        link.dataset.level = '3';
                        break;
                    case 'h4':
                        link.dataset.level = '4';
                        break;
                }
                link.title = element.innerText;
                let text = element.innerText;
                if (text.length > options.charLimit)
                    text = text.slice(0, options.charLimit) + '...';
                link.innerHTML = text;
                link.href = '#' + element.id;
                link.addEventListener('click', onLinkClick);

                // attach link
                panel.querySelector('#toc_list').appendChild(link);
            }
        }

        // when panel is clicked
        function onPanelClick(event) {
            // stop click from propagating to window/document and closing panel
            event.stopPropagation();
        }

        // when header itself is clicked
        function onHeaderClick(event) {
            togglePanel();
        }

        // when button is clicked
        function onButtonClick(event) {
            togglePanel();
            // stop header underneath button from also being clicked
            event.stopPropagation();
        }

        // when link is clicked
        function onLinkClick() {
            openOrClosePanel();
        }

        // open panel if closed, close if opened
        function togglePanel() {
            const panel = document.getElementById('toc_panel');
            if (!panel)
                return;

            if (panel.dataset.open === 'true')
                closePanel();
            else
                openPanel();
        }

        // open panel
        function openPanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'true';
        }

        // close panel
        function closePanel() {
            const panel = document.getElementById('toc_panel');
            if (panel)
                panel.dataset.open = 'false';
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- th list icon -->

<template class="icon_th_list">
    <!-- modified from: https://fontawesome.com/icons/th-list -->
    <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
        <path
            fill="currentColor"
            d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
            tabindex="-1"
        ></path>
    </svg>
</template>
<!-- lightbox plugin -->

<script>
    (function() {
        // /////////////////////////
        // DESCRIPTION
        // /////////////////////////

        // This Manubot plugin makes it such that when a user clicks on an
        // image, the image fills the screen and the user can pan/drag/zoom
        // the image and navigate between other images in the document.

        // /////////////////////////
        // OPTIONS
        // /////////////////////////

        // plugin name prefix for url parameters
        const pluginName = 'lightbox';

        // default plugin options
        const options = {
            // list of possible zoom/scale factors
            zoomSteps:
                '0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1,' +
                '1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8',
            // whether to fit image to view ('fit'), display at 100% and shrink
            // if necessary ('shrink'), or always display at 100% ('100')
            defaultZoom: 'fit',
            // whether to zoom in/out toward center of view ('true') or mouse
            // ('false')
            centerZoom: 'false',
            // whether plugin is on or not
            enabled: 'true'
        };

        // change options above, or override with url parameter, eg:
        // 'manuscript.html?pluginName-enabled=false'

        // /////////////////////////
        // SCRIPT
        // /////////////////////////

        // start script
        function start() {
            // run through each <img> element
            const imgs = document.querySelectorAll('figure > img');
            let count = 1;
            for (const img of imgs) {
                img.classList.add('lightbox_document_img');
                img.dataset.number = count;
                img.dataset.total = imgs.length;
                img.addEventListener('click', openLightbox);
                count++;
            }

            // attach mouse and key listeners to window
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('keyup', onKeyUp);
        }

        // when mouse is moved anywhere in window
        function onWindowMouseMove(event) {
            window.mouseX = event.clientX;
            window.mouseY = event.clientY;
        }

        // when key pressed
        function onKeyUp(event) {
            if (!event || !event.key)
                return;

            switch (event.key) {
                // trigger click of prev button
                case 'ArrowLeft':
                    const prevButton = document.getElementById(
                        'lightbox_prev_button'
                    );
                    if (prevButton)
                        prevButton.click();
                    break;
                // trigger click of next button
                case 'ArrowRight':
                    const nextButton = document.getElementById(
                        'lightbox_next_button'
                    );
                    if (nextButton)
                        nextButton.click();
                    break;
                // close on esc
                case 'Escape':
                    closeLightbox();
                    break;
            }
        }

        // open lightbox
        function openLightbox() {
            const lightbox = makeLightbox(this);
            if (!lightbox)
                return;

            blurBody(lightbox);
            document.body.appendChild(lightbox);
        }

        // make lightbox
        function makeLightbox(img) {
            // delete lightbox if it exists, start fresh
            closeLightbox();

            // create screen overlay containing lightbox
            const overlay = document.createElement('div');
            overlay.id = 'lightbox_overlay';

            // create image info boxes
            const numberInfo = document.createElement('div');
            const zoomInfo = document.createElement('div');
            numberInfo.id = 'lightbox_number_info';
            zoomInfo.id = 'lightbox_zoom_info';

            // create container for image
            const imageContainer = document.createElement('div');
            imageContainer.id = 'lightbox_image_container';
            const lightboxImg = makeLightboxImg(
                img,
                imageContainer,
                numberInfo,
                zoomInfo
            );
            imageContainer.appendChild(lightboxImg);

            // create bottom container for caption and navigation buttons
            const bottomContainer = document.createElement('div');
            bottomContainer.id = 'lightbox_bottom_container';
            const caption = makeCaption(img);
            const prevButton = makePrevButton(img);
            const nextButton = makeNextButton(img);
            bottomContainer.appendChild(prevButton);
            bottomContainer.appendChild(caption);
            bottomContainer.appendChild(nextButton);

            // attach top middle and bottom to overlay
            overlay.appendChild(numberInfo);
            overlay.appendChild(zoomInfo);
            overlay.appendChild(imageContainer);
            overlay.appendChild(bottomContainer);

            return overlay;
        }

        // make <img> object that is intuitively draggable and zoomable
        function makeLightboxImg(
            sourceImg,
            container,
            numberInfoBox,
            zoomInfoBox
        ) {
            // create copy of source <img>
            const img = sourceImg.cloneNode(true);
            img.classList.remove('lightbox_document_img');
            img.removeAttribute('id');
            img.removeAttribute('width');
            img.removeAttribute('height');
            img.style.position = 'unset';
            img.style.margin = '0';
            img.style.padding = '0';
            img.style.width = '';
            img.style.height = '';
            img.style.minWidth = '';
            img.style.minHeight = '';
            img.style.maxWidth = '';
            img.style.maxHeight = '';
            img.id = 'lightbox_img';

            // build sorted list of unique zoomSteps, always including a 100%
            let zoomSteps = [];
            const optionsZooms = options.zoomSteps.split(/[^0-9.]/);
            for (const optionZoom of optionsZooms) {
                const newZoom = parseFloat(optionZoom);
                if (newZoom && !zoomSteps.includes(newZoom))
                    zoomSteps.push(newZoom);
            }
            if (!zoomSteps.includes(1))
                zoomSteps.push(1);
            zoomSteps = zoomSteps.sort(function sortNumber(a, b) {
                return a - b;
            });

            // <img> object property variables
            let zoom = 1;
            let translateX = 0;
            let translateY = 0;
            let clickMouseX = undefined;
            let clickMouseY = undefined;
            let clickTranslateX = undefined;
            let clickTranslateY = undefined;

            updateNumberInfo();

            // update image numbers displayed in info box
            function updateNumberInfo() {
                numberInfoBox.innerHTML =
                    sourceImg.dataset.number + ' of ' + sourceImg.dataset.total;
            }

            // update zoom displayed in info box
            function updateZoomInfo() {
                let zoomInfo = zoom * 100;
                if (!Number.isInteger(zoomInfo))
                    zoomInfo = zoomInfo.toFixed(2);
                zoomInfoBox.innerHTML = zoomInfo + '%';
            }

            // move to closest zoom step above current zoom
            const zoomIn = function() {
                for (const zoomStep of zoomSteps) {
                    if (zoomStep > zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                updateTransform();
            };

            // move to closest zoom step above current zoom
            const zoomOut = function() {
                zoomSteps.reverse();
                for (const zoomStep of zoomSteps) {
                    if (zoomStep < zoom) {
                        zoom = zoomStep;
                        break;
                    }
                }
                zoomSteps.reverse();

                updateTransform();
            };

            // update display of <img> based on scale/translate properties
            const updateTransform = function() {
                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                // get new width/height after scale
                const rect = img.getBoundingClientRect();
                // limit translate
                translateX = Math.max(translateX, -rect.width / 2);
                translateX = Math.min(translateX, rect.width / 2);
                translateY = Math.max(translateY, -rect.height / 2);
                translateY = Math.min(translateY, rect.height / 2);

                // set transform
                img.style.transform =
                    'translate(' +
                    (translateX || 0) +
                    'px,' +
                    (translateY || 0) +
                    'px) scale(' +
                    (zoom || 1) +
                    ')';

                updateZoomInfo();
            };

            // fit <img> to container
            const fit = function() {
                // no x/y offset, 100% zoom by default
                translateX = 0;
                translateY = 0;
                zoom = 1;

                // widths of <img> and container
                const imgWidth = img.naturalWidth;
                const imgHeight = img.naturalHeight;
                const containerWidth = parseFloat(
                    window.getComputedStyle(container).width
                );
                const containerHeight = parseFloat(
                    window.getComputedStyle(container).height
                );

                // how much zooming is needed to fit <img> to container
                const xRatio = imgWidth / containerWidth;
                const yRatio = imgHeight / containerHeight;
                const maxRatio = Math.max(xRatio, yRatio);
                const newZoom = 1 / maxRatio;

                // fit <img> to container according to option
                if (options.defaultZoom === 'shrink') {
                    if (maxRatio > 1)
                        zoom = newZoom;
                } else if (options.defaultZoom === 'fit')
                    zoom = newZoom;

                updateTransform();
            };

            // when mouse wheel is rolled anywhere in container
            const onContainerWheel = function(event) {
                if (!event)
                    return;

                // let ctrl + mouse wheel to zoom behave as normal
                if (event.ctrlKey)
                    return;

                // prevent normal scroll behavior
                event.preventDefault();
                event.stopPropagation();

                // point around which to scale img
                const viewRect = container.getBoundingClientRect();
                const viewX = (viewRect.left + viewRect.right) / 2;
                const viewY = (viewRect.top + viewRect.bottom) / 2;
                const originX = options.centerZoom === 'true' ? viewX : mouseX;
                const originY = options.centerZoom === 'true' ? viewY : mouseY;

                // get point on image under origin
                const oldRect = img.getBoundingClientRect();
                const oldPercentX = (originX - oldRect.left) / oldRect.width;
                const oldPercentY = (originY - oldRect.top) / oldRect.height;

                // increment/decrement zoom
                if (event.deltaY < 0)
                    zoomIn();
                if (event.deltaY > 0)
                    zoomOut();

                // get offset between previous image point and origin
                const newRect = img.getBoundingClientRect();
                const offsetX =
                    originX - (newRect.left + newRect.width * oldPercentX);
                const offsetY =
                    originY - (newRect.top + newRect.height * oldPercentY);

                // translate image to keep image point under origin
                translateX += offsetX;
                translateY += offsetY;

                // perform translate
                updateTransform();
            };

            // when container is clicked
            function onContainerClick(event) {
                // if container itself is target of click, and not other
                // element above it
                if (event.target === this)
                    closeLightbox();
            }

            // when mouse button is pressed on image
            const onImageMouseDown = function(event) {
                // store original mouse position relative to image
                clickMouseX = window.mouseX;
                clickMouseY = window.mouseY;
                clickTranslateX = translateX;
                clickTranslateY = translateY;
                event.stopPropagation();
                event.preventDefault();
            };

            // when mouse button is released anywhere in window
            const onWindowMouseUp = function(event) {
                // reset original mouse position
                clickMouseX = undefined;
                clickMouseY = undefined;
                clickTranslateX = undefined;
                clickTranslateY = undefined;

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mouseup', onWindowMouseUp);
            };

            // when mouse is moved anywhere in window
            const onWindowMouseMove = function(event) {
                if (
                    clickMouseX === undefined ||
                    clickMouseY === undefined ||
                    clickTranslateX === undefined ||
                    clickTranslateY === undefined
                )
                    return;

                // offset image based on original and current mouse position
                translateX = clickTranslateX + window.mouseX - clickMouseX;
                translateY = clickTranslateY + window.mouseY - clickMouseY;
                updateTransform();
                event.preventDefault();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('mousemove', onWindowMouseMove);
            };

            // when window is resized
            const onWindowResize = function(event) {
                fit();

                // remove global listener if lightbox removed from document
                if (!document.body.contains(container))
                    window.removeEventListener('resize', onWindowResize);
            };

            // attach the necessary event listeners
            img.addEventListener('dblclick', fit);
            img.addEventListener('mousedown', onImageMouseDown);
            container.addEventListener('wheel', onContainerWheel);
            container.addEventListener('mousedown', onContainerClick);
            container.addEventListener('touchstart', onContainerClick);
            window.addEventListener('mouseup', onWindowMouseUp);
            window.addEventListener('mousemove', onWindowMouseMove);
            window.addEventListener('resize', onWindowResize);

            // run fit() after lightbox atttached to document and <img> Loaded
            // so needed container and img dimensions available
            img.addEventListener('load', fit);

            return img;
        }

        // make caption
        function makeCaption(img) {
            const caption = document.createElement('div');
            caption.id = 'lightbox_caption';
            const captionSource = img.nextElementSibling;
            if (captionSource.tagName.toLowerCase() === 'figcaption') {
                const captionCopy = makeCopy(captionSource);
                caption.innerHTML = captionCopy.innerHTML;
            }

            caption.addEventListener('touchstart', function(event) {
                event.stopPropagation();
            });

            return caption;
        }

        // make carbon copy of html dom element
        function makeCopy(source) {
            const sourceCopy = source.cloneNode(true);

            // delete elements marked with ignore (eg anchor and jump buttons)
            const deleteFromCopy = sourceCopy.querySelectorAll(
                '[data-ignore="true"]'
            );
            for (const element of deleteFromCopy)
                element.remove();

            // delete certain element attributes
            const attributes = [
                'id',
                'data-collapsed',
                'data-selected',
                'data-highlighted',
                'data-glow'
            ];
            for (const attribute of attributes) {
                sourceCopy.removeAttribute(attribute);
                const elements = sourceCopy.querySelectorAll(
                    '[' + attribute + ']'
                );
                for (const element of elements)
                    element.removeAttribute(attribute);
            }

            return sourceCopy;
        }

        // make button to jump to previous image in document
        function makePrevButton(img) {
            const prevButton = document.createElement('button');
            prevButton.id = 'lightbox_prev_button';
            prevButton.title = 'Jump to the previous image in the document [←]';
            prevButton.classList.add('icon_button', 'lightbox_button');
            prevButton.innerHTML = document.querySelector(
                '.icon_caret_left'
            ).innerHTML;

            // attach click listeners to button
            prevButton.addEventListener('click', function() {
                getPrevImg(img).click();
            });

            return prevButton;
        }

        // make button to jump to next image in document
        function makeNextButton(img) {
            const nextButton = document.createElement('button');
            nextButton.id = 'lightbox_next_button';
            nextButton.title = 'Jump to the next image in the document [→]';
            nextButton.classList.add('icon_button', 'lightbox_button');
            nextButton.innerHTML = document.querySelector(
                '.icon_caret_right'
            ).innerHTML;

            // attach click listeners to button
            nextButton.addEventListener('click', function() {
                getNextImg(img).click();
            });

            return nextButton;
        }

        // get previous image in document
        function getPrevImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if < 1
            if (index - 1 >= 0)
                index--;
            else
                index = imgs.length - 1;
            return imgs[index];
        }

        // get next image in document
        function getNextImg(img) {
            const imgs = document.querySelectorAll('.lightbox_document_img');

            // find index of provided img
            let index;
            for (index = 0; index < imgs.length; index++) {
                if (imgs[index] === img)
                    break;
            }


            // wrap index to other side if > total
            if (index + 1 <= imgs.length - 1)
                index++;
            else
                index = 0;
            return imgs[index];
        }

        // close lightbox
        function closeLightbox() {
            focusBody();

            const lightbox = document.getElementById('lightbox_overlay');
            if (lightbox)
                lightbox.remove();
        }

        // make all elements behind lightbox non-focusable
        function blurBody(overlay) {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.tabIndex = -1;
            document.body.classList.add('body_no_scroll');
        }

        // make all elements focusable again
        function focusBody() {
            const all = document.querySelectorAll('*');
            for (const element of all)
                element.removeAttribute('tabIndex');
            document.body.classList.remove('body_no_scroll');
        }

        // load options from url parameters
        function loadOptions() {
            const url = window.location.search;
            const params = new URLSearchParams(url);
            for (const optionName of Object.keys(options)) {
                const paramName = pluginName + '-' + optionName;
                const param = params.get(paramName);
                if (param !== '' && param !== null)
                    options[optionName] = param;
            }
        }
        loadOptions();

        // start script when document is finished loading
        if (options.enabled === 'true')
            window.addEventListener('load', start);
    })();
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
    <!-- modified from: https://fontawesome.com/icons/caret-left -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
        ></path>
    </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
    <!-- modified from: https://fontawesome.com/icons/caret-right -->
    <svg width="16" height="16" viewBox="0 0 192 512">
        <path
            fill="currentColor"
            d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
        ></path>
    </svg>
</template>
<!-- math plugin configuration -->

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        "CommonHTML": { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
        "SVG": { linebreaks: { automatic: true } }
    });
</script>

<!-- math plugin -->

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'MathJax' allows the proper rendering of
    // math/equations written in LaTeX.

    // https://www.mathjax.org/
</script>
<!-- annotations plugin configuration -->

<script>
    window.hypothesisConfig = function() {
        return {
            branding: {
                accentColor: '#2196f3',
                appBackgroundColor: '#f8f8f8',
                ctaBackgroundColor: '#f8f8f8',
                ctaTextColor: '#000000',
                selectionFontFamily: 'Open Sans, Helvetica, sans serif',
                annotationFontFamily: 'Open Sans, Helvetica, sans serif'
            }
        };
    };
</script>

<!-- annotations plugin -->

<script src='https://hypothes.is/embed.js'>
    // /////////////////////////
    // DESCRIPTION
    // /////////////////////////

    // This third-party plugin 'Hypothesis' allows public annotation of the
    // manuscript.

    // https://web.hypothes.is/
</script>
<!-- analytics plugin -->

<!-- copy and paste code from Google Analytics or similar service here -->
</body>
</html>
